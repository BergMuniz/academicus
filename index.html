<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Academicus AI | N√∫cleo de Apoio Pedag√≥gico</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; -webkit-font-smoothing: antialiased; }
        
        /* UI Elements & Inputs */
        /* No mobile, fonte 16px previne zoom autom√°tico do iOS */
        .input-field { transition: all 0.2s; font-size: 16px; } 
        @media (min-width: 768px) { .input-field { font-size: 0.875rem; } }

        .input-field:focus { box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); border-color: #2563eb; }
        
        /* Cards Interativos */
        .type-card { transition: all 0.2s ease; border: 1px solid #e2e8f0; cursor: pointer; position: relative; overflow: hidden; }
        .type-card:active { transform: scale(0.98); }
        .type-card.active { border-color: #2563eb; background-color: white; box-shadow: 0 4px 12px -2px rgba(37, 99, 235, 0.15); ring: 1px ring-color: #2563eb; }
        
        .card-content { max-height: 0; opacity: 0; overflow: hidden; transition: all 0.3s ease; }
        .type-card.active .card-content { max-height: 500px; opacity: 1; margin-top: 12px; padding-top: 12px; border-top: 1px solid #f1f5f9; }

        /* --- ESTILO DA PROVA (Formatada para Mobile e PC) --- */
        .prose { color: #334155; max-width: none; font-size: 0.95rem; }
        
        .prose h3 { 
            color: #1e3a8a; 
            font-size: 1.1rem; 
            border-bottom: 2px solid #e2e8f0; 
            padding-bottom: 0.5rem; 
            margin-top: 2rem; 
            margin-bottom: 1rem; 
            font-weight: 800; 
            text-transform: uppercase; 
            letter-spacing: 0.05em;
        }
        
        .prose strong { color: #0f172a; font-weight: 700; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; text-align: justify; }
        
        /* Lista de Alternativas */
        .prose ul { list-style: none; padding-left: 0; }
        .prose li { 
            margin-bottom: 0.75rem; 
            padding: 1rem; 
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        /* CAIXA DE GABARITO (Mobile Friendly) */
        .gabarito-box {
            background-color: #f0fdf4;
            border: 1px solid #86efac;
            border-left: 5px solid #16a34a;
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 2.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .gabarito-title {
            color: #166534;
            font-weight: 800;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 1px solid #bbf7d0;
            padding-bottom: 0.5rem;
        }
        
        /* CAIXA DE AUDITORIA */
        .audit-box {
            background-color: #fff1f2;
            border: 1px solid #fecdd3;
            border-left: 5px solid #e11d48;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-900 pb-10 lg:pb-0">

    <header class="bg-white border-b border-slate-200 px-4 py-3 sticky top-0 z-50 flex items-center justify-between shadow-sm no-print">
        <div class="flex items-center gap-2.5">
            <div class="bg-brand-600 p-1.5 rounded-lg text-white shadow-md"><i data-lucide="graduation-cap" class="w-5 h-5"></i></div>
            <div>
                <h1 class="text-lg font-bold text-slate-900 leading-none tracking-tight">Academicus AI</h1>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-0.5">N√∫cleo de Apoio Pedag√≥gico</p>
            </div>
        </div>
        <div class="hidden xs:flex bg-blue-50 text-blue-700 px-2.5 py-1 rounded-full border border-blue-100 font-bold text-[10px] items-center gap-1.5">
            <i data-lucide="sparkles" class="w-3 h-3"></i> <span class="hidden sm:inline">Powered by</span> Gemini 2.0
        </div>
    </header>

    <main class="w-full max-w-[1600px] mx-auto p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 flex-1">
        
        <aside class="lg:col-span-4 xl:col-span-3 space-y-4 lg:space-y-6 no-print">
            
            <div class="bg-slate-200 p-1 rounded-xl flex gap-1 font-bold shadow-inner">
                <button onclick="setMode('generator')" id="tab-gen" class="flex-1 py-3 text-xs rounded-lg flex items-center justify-center gap-2 bg-white text-brand-700 shadow-sm transition-all">
                    <i data-lucide="pen-tool" class="w-4 h-4"></i> Criar
                </button>
                <button onclick="setMode('auditor')" id="tab-aud" class="flex-1 py-3 text-xs rounded-lg flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 transition-all">
                    <i data-lucide="clipboard-check" class="w-4 h-4"></i> Auditar
                </button>
            </div>

            <div id="panel-generator" class="bg-white rounded-2xl border border-slate-200 shadow-sm p-4 lg:p-5 space-y-5">
                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 mb-1.5 uppercase tracking-wide">Curso</label>
                        <input type="text" id="curso" class="input-field w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 outline-none placeholder:text-slate-400" placeholder="Ex: Psicologia...">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 mb-1.5 uppercase tracking-wide">Objeto de Conhecimento</label>
                        <textarea id="conteudo" rows="3" class="input-field w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 outline-none placeholder:text-slate-400" placeholder="Ex: Terapia Cognitivo-Comportamental..."></textarea>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 mb-1.5 uppercase flex items-center gap-1">
                            <i data-lucide="target" class="w-3 h-3"></i> Objetivo (Opcional)
                        </label>
                        <input type="text" id="objetivo" class="input-field w-full px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm outline-none placeholder:text-slate-300" placeholder="Ex: Analisar criticamente...">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">Dificuldade</label>
                    <div class="grid grid-cols-3 gap-2 h-12">
                        <button onclick="setDiff('F√°cil')" id="diff-F√°cil" class="diff-card w-full h-full rounded-lg border border-slate-200 bg-white flex flex-col justify-center items-center"><span class="text-xs font-bold text-slate-400">F√°cil</span></button>
                        <button onclick="setDiff('M√©dio')" id="diff-M√©dio" class="diff-card w-full h-full rounded-lg border border-brand-300 bg-brand-50 flex flex-col justify-center items-center"><span class="text-xs font-bold text-brand-600">M√©dio</span></button>
                        <button onclick="setDiff('Dif√≠cil')" id="diff-Dif√≠cil" class="diff-card w-full h-full rounded-lg border border-slate-200 bg-white flex flex-col justify-center items-center"><span class="text-xs font-bold text-slate-400">Dif√≠cil</span></button>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">Taxonomia de Bloom</label>
                    <div class="grid grid-cols-3 lg:grid-cols-2 gap-2">
                        <button onclick="setBloom('Lembrar')" id="btn-Lembrar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Lembrar</button>
                        <button onclick="setBloom('Entender')" id="btn-Entender" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Entender</button>
                        <button onclick="setBloom('Aplicar')" id="btn-Aplicar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Aplicar</button>
                        <button onclick="setBloom('Analisar')" id="btn-Analisar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Analisar</button>
                        <button onclick="setBloom('Avaliar')" id="btn-Avaliar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Avaliar</button>
                        <button onclick="setBloom('Criar')" id="btn-Criar" class="bloom-btn py-2 rounded text-[10px] font-bold bg-indigo-50 text-indigo-700 border-indigo-200">Criar</button>
                    </div>
                </div>

                <div class="pt-4 border-t border-slate-100">
                    <label class="block text-[10px] font-bold text-slate-500 uppercase mb-3">Modelo da Quest√£o</label>
                    <div id="types-container" class="space-y-3"></div>
                </div>

                <button onclick="gerar()" id="btn-main" class="w-full bg-brand-600 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 transition-all hover:bg-brand-700 shadow-lg shadow-brand-200/50 mt-2 active:scale-95">
                    <span>Gerar Quest√£o</span>
                    <i data-lucide="zap" class="w-4 h-4"></i>
                </button>
            </div>

            <div id="panel-auditor" class="hidden bg-white rounded-2xl border border-slate-200 shadow-sm p-5 space-y-4">
                <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100 flex gap-3">
                    <i data-lucide="microscope" class="w-5 h-5 text-emerald-600 shrink-0"></i>
                    <div>
                        <h4 class="text-xs font-bold text-emerald-800">Auditoria INEP</h4>
                        <p class="text-[10px] text-emerald-700 mt-0.5">Cole a quest√£o para an√°lise t√©cnica.</p>
                    </div>
                </div>
                <textarea id="audit-input" rows="12" class="input-field w-full px-4 py-3 rounded-xl border border-emerald-100 bg-emerald-50/30 font-mono outline-none focus:border-emerald-500 text-slate-700 text-xs" placeholder="Cole o texto da quest√£o aqui..."></textarea>
                <button onclick="auditar()" id="btn-aud" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95">
                    <span>Executar Auditoria</span>
                    <i data-lucide="check-circle-2" class="w-4 h-4"></i>
                </button>
            </div>
        </aside>

        <div class="lg:col-span-8 xl:col-span-9 flex flex-col h-full scroll-mt-6" id="result-anchor">
            <div id="result-area" class="bg-white min-h-[500px] lg:min-h-[850px] rounded-2xl lg:rounded-[2rem] border border-slate-200 shadow-sm flex flex-col relative overflow-hidden transition-all">
                
                <div id="export-tools" class="hidden flex-wrap p-4 lg:p-0 gap-2 border-b lg:border-none border-slate-100 lg:absolute lg:top-6 lg:right-6 lg:z-20 no-print">
                    <button onclick="exportWord()" class="flex-1 lg:flex-none justify-center bg-white border border-slate-200 text-blue-700 px-4 py-2.5 rounded-lg hover:bg-blue-50 text-xs font-bold shadow-sm flex items-center gap-2 active:bg-blue-100">
                        <i data-lucide="file-text" class="w-4 h-4"></i> <span class="lg:hidden">Baixar</span> Word
                    </button>
                    <button onclick="exportPDF()" class="flex-1 lg:flex-none justify-center bg-white border border-slate-200 text-red-700 px-4 py-2.5 rounded-lg hover:bg-red-50 text-xs font-bold shadow-sm flex items-center gap-2 active:bg-red-100">
                        <i data-lucide="file-type-2" class="w-4 h-4"></i> <span class="lg:hidden">Baixar</span> PDF
                    </button>
                </div>

                <div id="placeholder" class="flex-1 flex flex-col items-center justify-center text-center p-8 lg:p-12">
                    <div class="bg-slate-50 p-5 rounded-full mb-4 ring-1 ring-slate-100"><i data-lucide="pen-tool" class="w-8 h-8 lg:w-10 lg:h-10 text-slate-300"></i></div>
                    <h3 class="text-base lg:text-lg font-bold text-slate-400">√Årea de Cria√ß√£o</h3>
                    <p class="text-slate-400 text-xs lg:text-sm mt-1 max-w-xs">Seus resultados aparecer√£o aqui ap√≥s a gera√ß√£o.</p>
                </div>
                
                <div id="ai-output" class="hidden text-left w-full max-w-4xl mx-auto p-6 lg:p-12 prose prose-slate"></div>
            </div>
        </div>
    </main>

    <script>
        // --- DADOS E TIPOS ---
        const TYPES = {
            "SINGLE": { title: "Resposta √önica", icon: "check-circle", desc: "M√∫ltipla escolha (A-E)." },
            "MULTIPLE": { title: "Compl. M√∫ltipla", icon: "layers", desc: "Itens Romanos (I, II, III)." },
            "ASSERTION": { title: "Asser√ß√£o/Raz√£o", icon: "git-compare", desc: "Duas afirma√ß√µes ligadas." },
            "DISCURSIVE": { title: "Discursiva", icon: "align-left", desc: "Quest√£o aberta." }
        };

        let state = {
            mode: 'generator',
            type: 'SINGLE',
            bloom: 'Criar',
            difficulty: 'M√©dio',
            multiRange: 4,
            assertionKey: 'A'
        };

        // --- UI UTILS ---
        function setMode(mode) {
            state.mode = mode;
            const isGen = mode === 'generator';
            document.getElementById('panel-generator').classList.toggle('hidden', !isGen);
            document.getElementById('panel-auditor').classList.toggle('hidden', isGen);
            
            // Estilo das abas
            document.getElementById('tab-gen').className = isGen ? 'flex-1 py-2.5 text-xs rounded-lg flex items-center justify-center gap-2 bg-white text-brand-700 shadow-sm transition-all font-bold' : 'flex-1 py-2.5 text-xs rounded-lg flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 transition-all';
            document.getElementById('tab-aud').className = !isGen ? 'flex-1 py-2.5 text-xs rounded-lg flex items-center justify-center gap-2 bg-white text-emerald-700 shadow-sm transition-all font-bold' : 'flex-1 py-2.5 text-xs rounded-lg flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 transition-all';
        }

        function renderTypes() {
            const container = document.getElementById('types-container');
            container.innerHTML = '';

            Object.entries(TYPES).forEach(([key, info]) => {
                const active = state.type === key;
                const card = document.createElement('div');
                card.className = `type-card p-3 rounded-xl bg-white ${active ? 'active' : 'border-slate-200'}`;
                card.onclick = () => { state.type = key; renderTypes(); };

                // Controles extras
                let extraControls = '';
                if (key === 'MULTIPLE' && active) {
                    extraControls = `
                        <div class="mt-3 pt-3 border-t border-slate-100 flex gap-2">
                            ${[3,4,5].map(n => `<button onclick="event.stopPropagation(); state.multiRange=${n}; renderTypes();" class="px-2 py-1 text-[10px] font-bold border rounded ${state.multiRange===n ? 'bg-brand-600 text-white' : 'bg-white text-slate-500'}">I a ${n===3?'III':n===4?'IV':'V'}</button>`).join('')}
                        </div>`;
                }
                if (key === 'ASSERTION' && active) {
                    extraControls = `
                        <div class="mt-3 pt-3 border-t border-slate-100 flex gap-2 overflow-x-auto pb-1">
                            ${['A','B','C','D','E'].map(l => `<button onclick="event.stopPropagation(); state.assertionKey='${l}'; renderTypes();" class="w-6 h-6 flex-shrink-0 flex items-center justify-center text-[10px] font-bold border rounded ${state.assertionKey===l ? 'bg-brand-600 text-white' : 'bg-white text-slate-500'}">${l}</button>`).join('')}
                        </div>`;
                }

                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="${active?'text-brand-600':'text-slate-400'}"><i data-lucide="${info.icon}" class="w-5 h-5"></i></div>
                            <span class="text-xs font-bold ${active?'text-brand-700':'text-slate-600'}">${info.title}</span>
                        </div>
                        ${active ? '<i data-lucide="check" class="w-4 h-4 text-brand-600"></i>' : ''}
                    </div>
                    <div class="card-content">
                        <p class="text-[10px] text-slate-500 leading-relaxed">${info.desc}</p>
                        ${extraControls}
                    </div>
                `;
                container.appendChild(card);
            });
            lucide.createIcons();
        }

        // --- SELETORES DE ESTADO ---
        function setDiff(val) {
            ['F√°cil', 'M√©dio', 'Dif√≠cil'].forEach(l => {
                document.getElementById(`diff-${l}`).className = 'diff-card w-full h-full rounded-lg border border-slate-200 bg-white flex flex-col justify-center items-center text-slate-400';
            });
            const active = document.getElementById(`diff-${val}`);
            active.className = 'diff-card w-full h-full rounded-lg border border-brand-500 bg-brand-50 flex flex-col justify-center items-center text-brand-700 ring-1 ring-brand-500';
            state.difficulty = val;
        }

        function setBloom(val) {
            document.querySelectorAll('.bloom-btn').forEach(b => b.className = 'bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white');
            const btn = document.getElementById(`btn-${val}`);
            btn.className = 'bloom-btn py-2 rounded text-[10px] font-bold bg-indigo-50 text-indigo-700 border-indigo-200 ring-1 ring-indigo-300';
            state.bloom = val;
        }

        // --- GERAR ---
        async function gerar() {
            const curso = document.getElementById('curso').value;
            const conteudo = document.getElementById('conteudo').value;
            
            if (!curso || !conteudo) return alert("Preencha Curso e Objeto de Conhecimento.");

            const btn = document.getElementById('btn-main');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Criando...`;
            btn.disabled = true;

            // L√≥gica do Prompt (Manteve-se a mesma poderosa da vers√£o anterior)
            let extras = "";
            if (state.type === 'MULTIPLE') extras = `ITENS ROMANOS OBRIGAT√ìRIOS: I a ${state.multiRange===3?'III':state.multiRange===4?'IV':'V'}.`;
            if (state.type === 'ASSERTION') {
                extras = `
                REGRA CR√çTICA PARA ASSER√á√ÉO E RAZ√ÉO:
                1. Voc√™ deve gerar a 'Asser√ß√£o I' e a 'Asser√ß√£o II' ligadas pela palavra PORQUE.
                2. O Gabarito deve ser a Letra ${state.assertionKey}.
                3. AS ALTERNATIVAS S√ÉO FIXAS (N√ÉO MUDE):
                   A) As asser√ß√µes I e II s√£o proposi√ß√µes verdadeiras, e a II √© uma justificativa correta da I.
                   B) As asser√ß√µes I e II s√£o proposi√ß√µes verdadeiras, mas a II n√£o √© uma justificativa correta da I.
                   C) A asser√ß√£o I √© uma proposi√ß√£o verdadeira, e a II √© uma proposi√ß√£o falsa.
                   D) A asser√ß√£o I √© uma proposi√ß√£o falsa, e a II √© uma proposi√ß√£o verdadeira.
                   E) As asser√ß√µes I e II s√£o proposi√ß√µes falsas.
                `;
            }

            const prompt = `
            ATUE COMO ESPECIALISTA DO INEP/ENADE.
            Crie uma quest√£o in√©dita seguindo estritamente este comando.
            
            DADOS:
            - Tipo: ${TYPES[state.type].title}
            - Curso: ${curso}
            - T√≥pico: ${conteudo}
            - Bloom: ${state.bloom}
            - Dificuldade: ${state.difficulty}
            ${extras}
            
            FORMATO DE SA√çDA OBRIGAT√ìRIO (MARKDOWN + HTML):
            Siga este template visual EXATAMENTE:

            ### Enunciado
            (Texto base rico e contextualizado, seguido do comando da quest√£o em negrito).

            ### Alternativas
            (Liste as alternativas aqui. Se for Asser√ß√£o e Raz√£o, use as fixas).

            <div class="gabarito-box">
            <div class="gabarito-title"><i data-lucide="check-circle-2"></i> GABARITO E AN√ÅLISE</div>
            <div class="gabarito-content">
            <p><strong>‚úÖ Resposta Correta:</strong> (Letra)</p>
            <p><strong>üí° Justificativa Pedag√≥gica:</strong> (Explica√ß√£o t√©cnica detalhada).</p>
            </div>
            </div>
            `;

            executeAI(prompt, btn, originalHTML);
        }

        // --- AUDITAR ---
        async function auditar() {
            const input = document.getElementById('audit-input').value;
            if (!input) return alert("Cole a quest√£o para auditar.");

            const btn = document.getElementById('btn-aud');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Auditando...`;
            btn.disabled = true;

            const prompt = `
            ATUE COMO AUDITOR DO INEP.
            Analise a quest√£o abaixo procurando falhas.
            
            QUEST√ÉO: ${input}

            FORMATO:
            ### Relat√≥rio de Auditoria
            <div class="audit-box">
            <h4>1. Enunciado</h4>
            <ul style="list-style:none; padding:0;">
                <li>(‚úÖ ou ‚ö†Ô∏è) <strong>Contexto:</strong> An√°lise...</li>
                <li>(‚úÖ ou ‚ö†Ô∏è) <strong>Comando:</strong> An√°lise...</li>
            </ul>
            <h4>2. Alternativas</h4>
            <ul style="list-style:none; padding:0;">
                <li>(‚úÖ ou ‚ö†Ô∏è) <strong>Plausibilidade:</strong> An√°lise...</li>
                <li>(‚úÖ ou ‚ö†Ô∏è) <strong>Pegadinhas:</strong> An√°lise...</li>
            </ul>
            <h4>3. Veredito</h4>
            <p>APROVADA / REQUER AJUSTES / REJEITADA</p>
            </div>
            `;

            executeAI(prompt, btn, originalHTML);
        }

        // --- EXECU√á√ÉO E AUTO-SCROLL ---
        async function executeAI(prompt, btn, originalHTML) {
            try {
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt })
                });
                
                const data = await response.json();
                if (data.error) throw new Error(data.error);

                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('export-tools').classList.remove('hidden');
                document.getElementById('export-tools').classList.add('flex'); // Garante display flex
                
                const output = document.getElementById('ai-output');
                output.classList.remove('hidden');
                output.innerHTML = marked.parse(data.text); 
                lucide.createIcons();

                // AUTO-SCROLL PARA MOBILE (A M√ÅGICA)
                if (window.innerWidth < 1024) {
                    setTimeout(() => {
                        document.getElementById('result-anchor').scrollIntoView({ behavior: 'smooth' });
                    }, 100);
                }

            } catch (error) {
                alert("Erro: " + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalHTML;
                lucide.createIcons();
            }
        }

        // --- EXPORTA√á√ÉO ---
        async function exportWord() {
            const { Document, Packer, Paragraph, TextRun } = docx;
            const text = document.getElementById('ai-output').innerText; 
            const doc = new Document({ sections: [{ children: [new Paragraph({ children: [new TextRun({text: "Academicus AI - Documento", bold: true, size: 32}), new TextRun({text: "\n\n"+text, size: 24})]})]}]});
            const blob = await Packer.toBlob(doc);
            saveAs(blob, "Academicus.docx");
        }

        function exportPDF() {
            const el = document.getElementById('ai-output');
            html2pdf().set({ margin: 1, filename: 'Academicus.pdf' }).from(el).save();
        }

        // Inicializa√ß√£o
        renderTypes();
        lucide.createIcons();
    </script>
</body>
</html>
