<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Academicus AI | Studio Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        inep: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' },
                        bloomSky: { 100: '#e0f2fe', 800: '#075985', border: '#7dd3fc' },
                        bloomBlue: { 100: '#dbeafe', 800: '#1e40af', border: '#93c5fd' },
                        bloomIndigo: { 100: '#e0e7ff', 800: '#3730a3', border: '#a5b4fc' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { background-color: #f8fafc; color: #1e293b; -webkit-font-smoothing: antialiased; }

        .type-card { border: 1px solid #e2e8f0; border-radius: 20px; background: white; padding: 18px; cursor: pointer; transition: all 0.3s ease; overflow: hidden; }
        .type-card.active { border-color: #0284c7; box-shadow: 0 15px 30px -5px rgba(2, 132, 199, 0.15); }
        .radio-circle { width: 22px; height: 22px; border-radius: 50%; border: 2px solid #cbd5e1; flex-shrink: 0; transition: all 0.2s; }
        .type-card.active .radio-circle { border-color: #0284c7; border-width: 7px; }

        .example-box { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 14px; padding: 16px; margin-top: 14px; font-size: 0.75rem; color: #475569; line-height: 1.7; white-space: pre-wrap; border-left: 5px solid #cbd5e1; }
        .example-header { display: flex; align-items: center; gap: 6px; font-size: 0.7rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 10px; }

        .ctrl-btn { padding: 10px 14px; border-radius: 12px; font-size: 0.75rem; font-weight: 800; border: 1px solid #e2e8f0; background: white; color: #64748b; flex: 1; display: flex; justify-content: center; }
        .ctrl-btn.active { background: #0284c7; border-color: #0284c7; color: white; }

        /* ESCADA DE DIFICULDADE */
        .diff-card { border-radius: 16px; border: 1px solid #e2e8f0; padding: 12px; height: 100px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; cursor: pointer; background: white; transition: all 0.2s; }
        .diff-bar { width: 100%; border-radius: 6px 6px 0 0; margin-bottom: 8px; background: #e2e8f0; transition: all 0.3s; }
        .diff-card.active-medium { background: #eff6ff; border-color: #60a5fa; }
        .diff-card.active-medium .diff-bar { background: #3b82f6; }

        /* PIRÂMIDE DE BLOOM */
        .bloom-pyramid-btn { padding: 10px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; border: 1px solid #e2e8f0; border-radius: 12px; transition: all 0.3s; background: white; color: #64748b; }
        .bloom-pyramid-btn.active { transform: scale(1.05); }
        #bloom-Criar.active, #bloom-Avaliar.active { background: #4f46e5; color: white; border-color: #4f46e5; }
        #bloom-Analisar.active, #bloom-Aplicar.active { background: #2563eb; color: white; border-color: #2563eb; }
        #bloom-Entender.active, #bloom-Lembrar.active { background: #0ea5e9; color: white; border-color: #0ea5e9; }

        .prose h3 { color: #0c4a6e; font-size: 1.2rem; font-weight: 900; border-bottom: 3px solid #e0f2fe; margin-top: 2.5rem; margin-bottom: 1.5rem; padding-bottom: 0.6rem; text-transform: uppercase; }
        .prose p { margin-bottom: 1.5rem; line-height: 1.8; text-align: justify; font-size: 1rem; }
        .prose li { display: block; margin-bottom: 1.2rem; }
        .gabarito-box { background: #f0fdf4; border: 1px solid #86efac; border-left: 8px solid #16a34a; padding: 2.25rem; border-radius: 20px; margin-top: 4rem; }
        
        input, textarea { font-size: 16px !important; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 h-20 flex items-center px-4 lg:px-12 justify-between shadow-sm">
        <div class="flex items-center gap-5">
            <div class="bg-inep-600 p-2.5 rounded-2xl text-white shrink-0 shadow-xl shadow-inep-100"><i data-lucide="graduation-cap" class="w-7 h-7"></i></div>
            <div class="leading-tight">
                <h1 class="text-2xl font-black text-slate-900 tracking-tighter">Academicus AI</h1>
                <p class="text-[11px] font-black text-inep-500 uppercase tracking-widest mt-1">Studio de Criação de Questões</p>
            </div>
        </div>
        <div class="flex bg-slate-100 p-1.5 rounded-2xl">
            <button onclick="setMode('generator')" id="tab-gen" class="px-6 py-2.5 rounded-xl text-xs font-black bg-white shadow-lg text-inep-700 uppercase">Design</button>
            <button onclick="setMode('auditor')" id="tab-aud" class="px-6 py-2.5 rounded-xl text-xs font-black text-slate-500 hover:text-slate-800 uppercase">Auditoria</button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto w-full p-4 lg:p-12 grid grid-cols-1 lg:grid-cols-12 gap-12 flex-1">
        
        <aside class="lg:col-span-5 space-y-10">
            <div id="panel-generator" class="space-y-10">
                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-2xl space-y-8">
                    <h3 class="text-lg font-black text-slate-800 uppercase flex items-center gap-3">
                        <i data-lucide="book-open" class="text-inep-600"></i> Especificações
                    </h3>
                    <div class="space-y-6">
                        <input id="curso" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none focus:bg-white transition-all font-medium" placeholder="Curso / Área...">
                        <textarea id="conteudo" rows="4" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none outline-none focus:bg-white transition-all font-medium" placeholder="Objeto de Conhecimento..."></textarea>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-6">
                    <label class="text-[11px] font-black text-slate-500 uppercase tracking-widest block">Nível de Dificuldade</label>
                    <div class="grid grid-cols-3 gap-3">
                        <div onclick="setDiff('Fácil')" id="diff-Fácil" class="diff-card"><div class="diff-bar" style="height:35%"></div><span class="text-[10px] font-bold">Fácil</span></div>
                        <div onclick="setDiff('Médio')" id="diff-Médio" class="diff-card active-medium"><div class="diff-bar" style="height:65%; background:#3b82f6"></div><span class="text-[10px] font-bold">Médio</span></div>
                        <div onclick="setDiff('Difícil')" id="diff-Difícil" class="diff-card"><div class="diff-bar" style="height:100%"></div><span class="text-[10px] font-bold">Difícil</span></div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-6">
                    <label class="text-[11px] font-black text-slate-500 uppercase tracking-widest block">Taxonomia de Bloom</label>
                    <div class="flex flex-col items-center gap-1.5 bg-slate-50 p-5 rounded-[2.5rem]">
                        <button onclick="setBloom('Criar')" id="bloom-Criar" class="bloom-pyramid-btn w-[40%]">Criar</button>
                        <button onclick="setBloom('Avaliar')" id="bloom-Avaliar" class="bloom-pyramid-btn w-[50%]">Avaliar</button>
                        <button onclick="setBloom('Analisar')" id="bloom-Analisar" class="bloom-pyramid-btn w-[60%]">Analisar</button>
                        <button onclick="setBloom('Aplicar')" id="bloom-Aplicar" class="bloom-pyramid-btn w-[70%]">Aplicar</button>
                        <button onclick="setBloom('Entender')" id="bloom-Entender" class="bloom-pyramid-btn w-[80%]">Entender</button>
                        <button onclick="setBloom('Lembrar')" id="bloom-Lembrar" class="bloom-pyramid-btn active w-[90%]">Lembrar</button>
                    </div>
                    <div id="bloom-info-box" class="mt-4 p-5 rounded-2xl border hidden">
                        <h4 id="bloom-info-title" class="font-black text-sm mb-1 uppercase"></h4>
                        <p id="bloom-info-desc" class="text-xs italic mb-4 leading-relaxed"></p>
                        <div class="pt-3 border-t border-black/5">
                            <span class="text-[10px] font-black uppercase opacity-60">Verbos Sugeridos</span>
                            <p id="bloom-info-verbs" class="text-xs font-bold mt-1"></p>
                        </div>
                    </div>
                </div>

                <div id="types-container" class="space-y-4"></div>

                <div class="bg-white p-7 rounded-[2.5rem] border border-slate-200 shadow-sm flex items-center justify-between">
                    <span class="text-xs font-black uppercase text-slate-500">Quantidade</span>
                    <div class="flex items-center gap-5">
                        <button onclick="updateQty(-1)" class="w-12 h-12 border-2 rounded-xl flex items-center justify-center font-black">-</button>
                        <span id="qty-val" class="font-black text-slate-900 text-2xl w-8 text-center">1</span>
                        <button onclick="updateQty(1)" class="w-12 h-12 border-2 rounded-xl flex items-center justify-center font-black">+</button>
                    </div>
                </div>

                <button onclick="gerar()" id="btn-main" class="w-full bg-inep-600 text-white font-black py-6 rounded-[2rem] shadow-2xl active:scale-95 transition-all text-xl uppercase tracking-tighter">Gerar Questão Studio Pro</button>
            </div>
        </aside>

        <div id="result-anchor" class="lg:col-span-7">
            <div class="bg-white min-h-[900px] border border-slate-200 rounded-[3.5rem] shadow-2xl p-8 lg:p-16 relative flex flex-col">
                <div id="tools" class="flex justify-end gap-4 mb-12 opacity-0 transition-all duration-1000">
                    <button onclick="exportWord()" class="px-6 py-3 border-2 border-blue-100 rounded-2xl text-xs font-black text-blue-700 bg-blue-50">Word</button>
                    <button onclick="exportPdf()" class="px-6 py-3 border-2 border-red-100 rounded-2xl text-xs font-black text-red-700 bg-red-50">PDF</button>
                </div>
                <div id="placeholder" class="flex-1 flex flex-col items-center justify-center text-center p-12 opacity-20">
                    <i data-lucide="sparkles" class="w-24 h-24 text-slate-300 mb-8"></i>
                    <h3 class="text-3xl font-black text-slate-400 uppercase tracking-[0.3em]">Studio</h3>
                </div>
                <div id="output" class="hidden prose prose-slate max-w-none text-base leading-relaxed animate-fade-in font-medium"></div>
            </div>
        </div>
    </main>

    <script>
        const BLOOM_INFO = {
            "Criar": { color: "indigo", desc: "Produzir um novo ponto de vista ou produto.", verbs: "GERAR, PLANEJAR, DESENVOLVER, CONSTRUIR, PROJETAR." },
            "Avaliar": { color: "indigo", desc: "Fazer julgamentos baseados em critérios.", verbs: "JULGAR, CRITICAR, SELECIONAR, VALIDAR, CONCLUIR." },
            "Analisar": { color: "blue", desc: "Separar material em partes constituintes.", verbs: "DIFERENCIAR, ORGANIZAR, ATRIBUIR, DECOMPOR, INVESTIGAR." },
            "Aplicar": { color: "blue", desc: "Executar ou usar um procedimento em uma situação específica.", verbs: "EXECUTAR, IMPLEMENTAR, USAR, DEMONSTRAR, RESOLVER." },
            "Entender": { color: "sky", desc: "Construir significado a partir de mensagens.", verbs: "EXPLICAR, RESUMIR, INFERIR, PARAFRASEAR, INTERPRETAR." },
            "Lembrar": { color: "sky", desc: "Recuperar conhecimento relevante da memória.", verbs: "CITAR, DEFINIR, LISTAR, IDENTIFICAR, RECORDAR." }
        };

        const TYPES = {
            "SINGLE": { label: "Resposta Única", icon: "check-circle", example: "As mitocôndrias são organelas fundamentais para a vida celular eucariótica. Elas desempenham funções vitais relacionadas ao metabolismo energético por meio da cadeia transportadora de elétrons e da produção de ATP.\n\n<strong>Fonte:</strong> Junqueira, L. C.; Carneiro, J. Biologia Celular. Guanabara Koogan, 2012.\n\nQual a principal função da mitocôndria na célula animal.\n\na) Realizar a fotossíntese.\nb) Produzir ATP celular.\nc) Sintetizar proteínas.\nd) Armazenar DNA.\ne) Realizar a digestão." },
            "INCOMPLETE": { label: "Afirmação Incompleta", icon: "pen-tool", example: "A Primeira Lei de Newton descreve o comportamento de corpos em repouso quando a resultante das forças externas é nula. Esse conceito é fundamental para entender a inércia.\n\n<strong>Fonte:</strong> Halliday, D. Fundamentos de Física. LTC, 2014.\n\nA inércia é definida, no contexto da física clássica, como a tendência natural de um corpo em\n\na) aumentar sua velocidade constantemente.\nb) permanecer em seu estado de repouso ou movimento retilíneo uniforme.\nc) alterar sua massa independentemente da força.\nd) desacelerar na ausência de atrito.\ne) reagir instantaneamente a forças internas." },
            "MULTIPLE": { label: "Complementação Múltipla", icon: "layers" },
            "ASSERTION": { label: "Asserção e Razão", icon: "git-compare", example: "O TPAC afeta a interpretação sonora, exigindo avaliações específicas.\n\n<strong>Fonte:</strong> Katz, J. Tratado de Audiologia. Manole, 1999.\n\nAnalise as seguintes asserções e a relação proposta entre elas.\n\nI. O diagnóstico diferencial do TPAC é essencial.\n\n<div class=\"text-center font-bold py-3\">PORQUE</div>\n\nII. O TPAC envolve falha nas vias centrais.\n\nA respeito dessas asserções, assinale a opção correta.\n\na) As asserções I e II são verdadeiras, e a II justifica a I." },
            "DISCURSIVE": { label: "Discursiva", icon: "file-text", example: "A IA Generativa tem reconfigurado o ensino superior e os processos tradicionais de avaliação.\n\n<strong>Fonte:</strong> UNESCO. Inteligência artificial e educação. 2023.\n\nCom base nesse contexto, redija um texto dissertativo analisando os seguintes aspectos.\n\na) O impacto da IA na personalização.\nb) Os desafios éticos e plágio.\nc) O papel do docente como mediador." }
        };

        const ASSERTION_LOGIC = { 'A': 'As asserções I e II são proposições verdadeiras, e a II é uma justificativa correta da I.', 'B': 'As asserções I e II são proposições verdadeiras, mas a II não é uma justificativa correta da I.', 'C': 'A asserção I é uma proposição verdadeira, e a II é uma proposição falsa.', 'D': 'A asserção I é uma proposição falsa, e a II é uma proposição verdadeira.', 'E': 'As asserções I e II são proposições falsas.' };

        let STATE = { diff: 'Médio', bloom: 'Lembrar', type: 'SINGLE', assertionKey: 'A', multiRange: 4, quantity: 1 };

        function init() { renderTypes(); lucide.createIcons(); setBloom('Lembrar'); }

        function renderTypes() {
            const container = document.getElementById('types-container');
            container.innerHTML = '';
            Object.entries(TYPES).forEach(([key, info]) => {
                const active = STATE.type === key;
                const div = document.createElement('div');
                div.className = `type-card ${active ? 'active' : ''}`;
                div.onclick = () => { STATE.type = key; renderTypes(); };
                let html = `<div class="flex items-center gap-4"><i data-lucide="${info.icon}" class="w-6 h-6 text-inep-600"></i><div class="flex-1 font-bold text-sm text-slate-800">${info.label}</div><div class="radio-circle"></div></div>`;
                if (active) {
                    let exText = info.example || "";
                    if (key === 'MULTIPLE') {
                        let cmd = STATE.multiRange === 3 ? "É correto o que se afirma em" : "É correto apenas o que se afirma em";
                        exText = `A água possui propriedades únicas.\n\n<strong>Fonte:</strong> NAP Pesquisa. 2024.\n\nAvalie as afirmações a seguir.\n\nI. Solvente universal.\nII. Calor específico baixo.\nIII. Caráter apolar.\n\n${cmd}.\n\na) I.\nb) II.\nc) III.`;
                    }
                    html += `<div class="example-box font-medium">${exText}</div>`;
                    if (key === 'MULTIPLE') html += `<div class="mt-5 flex gap-2">${[3,4,5].map(n => `<button onclick="event.stopPropagation(); STATE.multiRange=${n}; renderTypes();" class="ctrl-btn ${STATE.multiRange===n?'active':''}">I a ${n===3?'III':n===4?'IV':'V'}</button>`).join('')}</div>`;
                    if (key === 'ASSERTION') html += `<div class="mt-4 p-4 bg-slate-50 rounded-2xl text-[10px] font-bold text-inep-700 italic border-l-4 border-inep-500 animate-fade-in">${ASSERTION_LOGIC[STATE.assertionKey]}</div>`;
                }
                div.innerHTML = html; container.appendChild(div);
            });
            lucide.createIcons();
        }

        function setDiff(val) {
            STATE.diff = val;
            document.querySelectorAll('.diff-card').forEach(el => {
                el.classList.remove('active-medium'); const bar = el.querySelector('.diff-bar'); bar.style.backgroundColor = '#e2e8f0';
                if(el.id.includes(val)) { el.classList.add('active-medium'); bar.style.backgroundColor = '#3b82f6'; }
            });
        }

        function setBloom(val) {
            STATE.bloom = val; const info = BLOOM_INFO[val];
            document.querySelectorAll('.bloom-pyramid-btn').forEach(b => { b.classList.remove('active'); if(b.id === `bloom-${val}`) b.classList.add('active'); });
            const box = document.getElementById('bloom-info-box'); box.classList.remove('hidden');
            document.getElementById('bloom-info-title').innerText = val;
            document.getElementById('bloom-info-desc').innerText = info.desc;
            document.getElementById('bloom-info-verbs').innerText = info.verbs;
        }

        function updateQty(n) { STATE.quantity = Math.max(1, Math.min(10, STATE.quantity + n)); document.getElementById('qty-val').innerText = STATE.quantity; }

        function setMode(mode) {
            const isGen = mode === 'generator';
            document.getElementById('tab-gen').className = isGen ? "px-6 py-2.5 rounded-xl text-xs font-black bg-white shadow-lg text-inep-700 uppercase" : "px-6 py-2.5 rounded-xl text-xs font-black text-slate-500 hover:text-slate-800 transition-all uppercase";
        }

        async function gerar() {
            const btn = document.getElementById('btn-main'); const curso = document.getElementById('curso').value; const conteudo = document.getElementById('conteudo').value;
            if(!curso || !conteudo) return alert("Erro: Preencha todos os campos.");
            btn.innerHTML = 'Construindo Questão de Avaliação Profissional...'; btn.disabled = true;

            let promptExtras = "";
            if (STATE.type === 'ASSERTION') promptExtras = `GABARITO: ${STATE.assertionKey}. REGRAS: Comandos terminam em PONTO FINAL (.). O PORQUE deve vir centralizado: <div style="text-align:center; font-weight:bold; margin:15px 0;">PORQUE</div>.`;
            if (STATE.type === 'INCOMPLETE') promptExtras = `REGRA CRÍTICA: O enunciado deve terminar de forma incompleta, SEM ponto final. As alternativas devem completar a frase e começar com minúscula.`;
            if (STATE.type === 'DISCURSIVE') promptExtras = `ESTRUTURA: Itens a), b) e c) em linhas separadas. GRADE DE CORREÇÃO: Título centralizado e negrito: <div style="text-align:center; font-weight:bold; margin-top:30px; text-transform:uppercase;">GRADE DE CORREÇÃO</div>. ITENS DA GRADE: Formato "Critério - Descrição" sem numeração de pontos.`;

            const prompt = `Atue como Especialista INEP. NUNCA use o vocativo "Prezado docente," nem rótulos como "Texto de suporte:". QUANTIDADE: Gere EXATAMENTE ${STATE.quantity} questões completas.

            REGRAS CRÍTICAS:
            1. NÃO use os rótulos "Texto de suporte:", "Comando:", "Fonte:" ou "Itens:".
            2. ITENS/ALTERNATIVAS: Sempre um abaixo do outro com quebra de linha.
            3. DISCURSIVA: Obrigatoriamente com os tópicos a), b) e c) para resposta.
            4. TEXTO BASE: +500 caracteres densos.
            5. FONTE: Bibliografia real logo abaixo do texto base, formatada como <strong>Fonte:</strong> [Referência].
            6. EXPLICAÇÃO TÉCNICA: Justificativa pedagógica completa no final.
            7. GRADE DE CORREÇÃO: Título centralizado sem asteriscos, itens com hífen e sem pontos numéricos.
            
            SAÍDA: (Texto suporte). (Fonte HTML). (Comando). (Alternativas/Itens a,b,c). (Grade de Correção). (Explicação). Separe questões com "---".`;

            try {
                const res = await fetch('/api/gemini', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ prompt }) });
                const data = await res.json();
                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('output').classList.remove('hidden');
                document.getElementById('tools').classList.remove('opacity-0');
                document.getElementById('output').innerHTML = marked.parse(data.text);
                if (window.innerWidth < 1024) setTimeout(() => { document.getElementById('result-anchor').scrollIntoView({ behavior: 'smooth' }); }, 100);
            } catch(e) { alert("Erro de conexão."); } finally { btn.innerHTML = 'Gerar Questão Studio Pro'; btn.disabled = false; }
        }

        function exportWord() {
            const text = document.getElementById('output').innerText;
            const lines = text.split('\n');
            const doc = new docx.Document({
                sections: [{
                    children: lines.map(line => new docx.Paragraph({
                        children: [new docx.TextRun({ text: line, size: 24, font: "Arial" })],
                        spacing: { after: 200 }
                    }))
                }]
            });
            docx.Packer.toBlob(doc).then(blob => saveAs(blob, "Questao_StudioPro.docx"));
        }

        function exportPdf() {
            const el = document.getElementById('output');
            html2pdf().set({ margin: 20, filename: 'Academicus_StudioPro.pdf', image: { type: 'jpeg', quality: 1 }, html2canvas: { scale: 3 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } }).from(el).save();
        }

        init();
    </script>
</body>
</html>
