<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Academicus AI | Studio Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        inep: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' },
                        bloomSky: { 100: '#e0f2fe', 800: '#075985', border: '#7dd3fc' },
                        bloomBlue: { 100: '#dbeafe', 800: '#1e40af', border: '#93c5fd' },
                        bloomIndigo: { 100: '#e0e7ff', 800: '#3730a3', border: '#a5b4fc' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { background-color: #f8fafc; color: #1e293b; -webkit-font-smoothing: antialiased; }

        .type-card { border: 1px solid #e2e8f0; border-radius: 20px; background: white; padding: 18px; cursor: pointer; transition: all 0.3s ease; overflow: hidden; }
        .type-card.active { border-color: #0284c7; box-shadow: 0 15px 30px -5px rgba(2, 132, 199, 0.15); }
        .radio-circle { width: 22px; height: 22px; border-radius: 50%; border: 2px solid #cbd5e1; flex-shrink: 0; transition: all 0.2s; }
        .type-card.active .radio-circle { border-color: #0284c7; border-width: 7px; }

        .example-box { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 14px; padding: 16px; margin-top: 14px; font-size: 0.75rem; color: #475569; line-height: 1.7; white-space: pre-wrap; border-left: 5px solid #cbd5e1; }
        
        /* ESCADA DE DIFICULDADE */
        .diff-card { border-radius: 16px; border: 1px solid #e2e8f0; padding: 12px; height: 100px; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; cursor: pointer; background: white; transition: all 0.2s; }
        .diff-bar { width: 100%; border-radius: 6px 6px 0 0; margin-bottom: 8px; background: #e2e8f0; transition: all 0.3s; }
        .diff-card.active-medium { background: #eff6ff; border-color: #60a5fa; }
        .diff-card.active-medium .diff-bar { background: #3b82f6; }

        /* PIRÂMIDE DE BLOOM */
        .bloom-pyramid-btn { padding: 10px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; border: 1px solid #e2e8f0; border-radius: 12px; transition: all 0.3s; background: white; color: #64748b; }
        .bloom-pyramid-btn.active { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        #bloom-Criar.active, #bloom-Avaliar.active { background: #4f46e5; color: white; border-color: #4f46e5; }
        #bloom-Analisar.active, #bloom-Aplicar.active { background: #2563eb; color: white; border-color: #2563eb; }
        #bloom-Entender.active, #bloom-Lembrar.active { background: #0ea5e9; color: white; border-color: #0ea5e9; }

        /* OUTPUT */
        .prose h3 { color: #0c4a6e; font-size: 1.2rem; font-weight: 900; border-bottom: 3px solid #e0f2fe; margin-top: 2.5rem; margin-bottom: 1.5rem; padding-bottom: 0.6rem; text-transform: uppercase; }
        .prose p { margin-bottom: 1.5rem; line-height: 1.8; text-align: justify; font-size: 1rem; }
        .prose li { display: block; margin-bottom: 1.2rem; }
        .gabarito-box { background: #f0fdf4; border: 1px solid #86efac; border-left: 8px solid #16a34a; padding: 2.25rem; border-radius: 20px; margin-top: 4rem; }
        
        input, textarea { font-size: 16px !important; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 h-20 flex items-center px-4 lg:px-12 justify-between shadow-sm">
        <div class="flex items-center gap-5">
            <div class="bg-inep-600 p-2.5 rounded-2xl text-white shrink-0 shadow-xl shadow-inep-100"><i data-lucide="graduation-cap" class="w-7 h-7"></i></div>
            <div class="leading-tight">
                <h1 class="text-2xl font-black text-slate-900 tracking-tighter">Academicus AI</h1>
                <p class="text-[11px] font-black text-inep-500 uppercase tracking-widest mt-1">Studio de Criação de Questões</p>
            </div>
        </div>
        <div class="flex bg-slate-100 p-1.5 rounded-2xl">
            <button onclick="setMode('generator')" id="tab-gen" class="px-6 py-2.5 rounded-xl text-xs font-black bg-white shadow-lg text-inep-700 uppercase">Design</button>
            <button onclick="setMode('auditor')" id="tab-aud" class="px-6 py-2.5 rounded-xl text-xs font-black text-slate-500 hover:text-slate-800 uppercase">Auditoria</button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto w-full p-4 lg:p-12 grid grid-cols-1 lg:grid-cols-12 gap-12 flex-1">
        
        <aside class="lg:col-span-5 space-y-10">
            <div id="panel-generator" class="space-y-10">
                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-2xl space-y-8">
                    <h3 class="text-lg font-black text-slate-800 uppercase flex items-center gap-3">
                        <i data-lucide="book-open" class="text-inep-600"></i> Especificações
                    </h3>
                    <div class="space-y-6">
                        <input id="curso" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none focus:bg-white transition-all font-medium" placeholder="Curso / Área...">
                        <textarea id="conteudo" rows="4" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none outline-none focus:bg-white transition-all font-medium" placeholder="Objeto de Conhecimento..."></textarea>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-6">
                    <label class="text-[11px] font-black text-slate-500 uppercase tracking-widest block">Nível de Dificuldade</label>
                    <div class="grid grid-cols-3 gap-3">
                        <div onclick="setDiff('Fácil')" id="diff-Fácil" class="diff-card"><div class="diff-bar" style="height:35%"></div><span class="text-[10px] font-bold">Fácil</span></div>
                        <div onclick="setDiff('Médio')" id="diff-Médio" class="diff-card active-medium"><div class="diff-bar" style="height:65%; background:#3b82f6"></div><span class="text-[10px] font-bold">Médio</span></div>
                        <div onclick="setDiff('Difícil')" id="diff-Difícil" class="diff-card"><div class="diff-bar" style="height:100%"></div><span class="text-[10px] font-bold">Difícil</span></div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-6">
                    <label class="text-[11px] font-black text-slate-500 uppercase tracking-widest block">Taxonomia de Bloom</label>
                    <div class="flex flex-col items-center gap-1.5 bg-slate-50 p-5 rounded-[2.5rem]">
                        <button onclick="setBloom('Criar')" id="bloom-Criar" class="bloom-pyramid-btn w-[40%]">Criar</button>
                        <button onclick="setBloom('Avaliar')" id="bloom-Avaliar" class="bloom-pyramid-btn w-[50%]">Avaliar</button>
                        <button onclick="setBloom('Analisar')" id="bloom-Analisar" class="bloom-pyramid-btn w-[60%]">Analisar</button>
                        <button onclick="setBloom('Aplicar')" id="bloom-Aplicar" class="bloom-pyramid-btn w-[70%]">Aplicar</button>
                        <button onclick="setBloom('Entender')" id="bloom-Entender" class="bloom-pyramid-btn w-[80%]">Entender</button>
                        <button onclick="setBloom('Lembrar')" id="bloom-Lembrar" class="bloom-pyramid-btn active w-[90%]">Lembrar</button>
                    </div>
                    <div id="bloom-info-box" class="mt-4 p-5 rounded-2xl border hidden">
                        <h4 id="bloom-info-title" class="font-black text-sm mb-1 uppercase"></h4>
                        <p id="bloom-info-desc" class="text-xs italic mb-4 leading-relaxed"></p>
                        <div class="pt-3 border-t border-black/5">
                            <span class="text-[9px] font-black uppercase opacity-60 tracking-wider">Verbos Sugeridos</span>
                            <p id="bloom-info-verbs" class="text-xs font-bold mt-1"></p>
                        </div>
                    </div>
                </div>

                <div id="types-container" class="space-y-4"></div>

                <div class="bg-white p-7 rounded-[2.5rem] border border-slate-200 shadow-sm flex items-center justify-between">
                    <span class="text-xs font-black uppercase text-slate-500">Quantidade</span>
                    <div class="flex items-center gap-5 bg-slate-50 p-2 rounded-2xl border border-slate-100">
                        <button onclick="updateQty(-1)" class="w-12 h-12 border-2 rounded-xl bg-white shadow-sm flex items-center justify-center font-bold font-black text-xl text-slate-400 hover:text-inep-600 transition-all">-</button>
                        <span id="qty-val" class="font-black text-slate-900 text-2xl w-8 text-center">1</span>
                        <button onclick="updateQty(1)" class="w-12 h-12 border-2 rounded-xl bg-white shadow-sm flex items-center justify-center font-bold font-black text-xl text-slate-400 hover:text-inep-600 transition-all">+</button>
                    </div>
                </div>

                <button onclick="gerar()" id="btn-main" class="w-full bg-inep-600 text-white font-black py-6 rounded-[2rem] shadow-2xl active:scale-95 hover:bg-inep-700 transition-all text-xl uppercase tracking-tighter">Gerar Questão Studio Pro</button>
            </div>
        </aside>

        <div id="result-anchor" class="lg:col-span-7">
            <div class="bg-white min-h-[900px] border border-slate-200 rounded-[3.5rem] shadow-2xl p-8 lg:p-16 relative flex flex-col">
                <div id="tools" class="flex justify-end gap-4 mb-12 opacity-0 transition-all duration-1000">
                    <button onclick="exportWord()" class="px-6 py-3 border-2 border-blue-100 rounded-2xl text-xs font-black text-blue-700 bg-blue-50">Word</button>
                    <button onclick="exportPdf()" class="px-6 py-3 border-2 border-red-100 rounded-2xl text-xs font-black text-red-700 bg-red-50">PDF</button>
                </div>
                <div id="placeholder" class="flex-1 flex flex-col items-center justify-center text-center p-12 opacity-20">
                    <i data-lucide="sparkles" class="w-24 h-24 text-slate-300 mb-8"></i>
                    <h3 class="text-3xl font-black text-slate-400 uppercase tracking-[0.3em]">Studio</h3>
                </div>
                <div id="output" class="hidden prose prose-slate max-w-none text-base leading-relaxed animate-fade-in font-medium"></div>
            </div>
        </div>
    </main>

    <script>
        const BLOOM_INFO = {
            "Criar": { color: "indigo", desc: "Produzir um novo ponto de vista ou produto. Juntar partes para formar um todo coerente.", verbs: "GERAR, PLANEJAR, DESENVOLVER, CONSTRUIR, PROJETAR, PROPOR." },
            "Avaliar": { color: "indigo", desc: "Fazer julgamentos baseados em critérios. Emitir conclusões fundamentadas.", verbs: "JULGAR, CRITICAR, SELECIONAR, VALIDAR, REVISAR, CONCLUIR." },
            "Analisar": { color: "blue", desc: "Separar material em partes constituintes e determinar relações estruturais.", verbs: "DIFERENCIAR, ORGANIZAR, ATRIBUIR, DECOMPOR, INVESTIGAR." },
            "Aplicar": { color: "blue", desc: "Executar ou usar um procedimento em uma situação específica.", verbs: "EXECUTAR, IMPLEMENTAR, USAR, DEMONSTRAR, CALCULAR, RESOLVER." },
            "Entender": { color: "sky", desc: "Construir significado a partir de mensagens, interpretando e resumindo informações.", verbs: "EXPLICAR, RESUMIR, INFERIR, PARAFRASEAR, INTERPRETAR." },
            "Lembrar": { color: "sky", desc: "Recuperar conhecimento relevante da memória de longo prazo para recordar fatos.", verbs: "CITAR, DEFINIR, LISTAR, IDENTIFICAR, NOMEAR, RECORDAR." }
        };

        const TYPES = {
            "SINGLE": { label: "Resposta Única", icon: "check-circle", example: "Texto suporte denso (+500 caracteres).\n\n<strong>Fonte:</strong> Referência bibliográfica.\n\nQual o conceito principal apresentado.\n\na) Correta.\nb) Distrator." },
            "INCOMPLETE": { label: "Afirmação Incompleta", icon: "pen-tool", example: "O fenômeno descrito no texto fundamentado é caracterizado pela\n\na) alternativa correta.\nb) alternativa incorreta.\n\n<strong>Fonte:</strong> Pesquisa NAP 2026." },
            "MULTIPLE": { label: "Complementação Múltipla", icon: "layers" },
            "ASSERTION": { label: "Asserção e Razão", icon: "git-compare", example: "Texto técnico (+500 caracteres).\n\n<strong>Fonte:</strong> Referência.\n\nAnalise as seguintes asserções e a relação proposta entre elas.\n\nI. Proposição.\n\n<div class=\"text-center font-bold py-3\">PORQUE</div>\n\nII. Razão.\n\nA respeito dessas asserções, assinale a opção correta.\n\na) As asserções I e II são verdadeiras e a II justifica a I." },
            "DISCURSIVE": { label: "Discursiva", icon: "file-text", example: "Texto suporte com +500 caracteres.\n\n<strong>Fonte:</strong> Referência.\n\nCom base nesse contexto, redija um texto dissertativo analisando os seguintes aspectos.\n\na) Primeiro tópico técnico.\nb) Segundo tópico técnico.\nc) Terceiro tópico técnico." }
        };

        const ASSERTION_LOGIC = { 'A': 'As asserções I e II são proposições verdadeiras, e a II é uma justificativa correta da I.', 'B': 'As asserções I e II são proposições verdadeiras, mas a II não é uma justificativa correta da I.', 'C': 'A asserção I é uma proposição verdadeira, e a II é uma proposição falsa.', 'D': 'A asserção I é uma proposição falsa, e a II é uma proposição verdadeira.', 'E': 'As asserções I e II são proposições falsas.' };

        let STATE = { diff: 'Médio', bloom: 'Lembrar', type: 'SINGLE', assertionKey: 'A', multiRange: 4, quantity: 1 };

        function init() { renderTypes(); lucide.createIcons(); setBloom('Lembrar'); }

        function renderTypes() {
            const container = document.getElementById('types-container');
            container.innerHTML = '';
            Object.entries(TYPES).forEach(([key, info]) => {
                const active = STATE.type === key;
                const div = document.createElement('div');
                div.className = `type-card ${active ? 'active' : ''}`;
                div.onclick = () => { STATE.type = key; renderTypes(); };
                let html = `<div class="flex items-center gap-4"><i data-lucide="${info.icon}" class="w-6 h-6 text-inep-600"></i><div class="flex-1 font-bold text-sm text-slate-800">${info.label}</div><div class="radio-circle"></div></div>`;
                if (active) {
                    html += `<div class="example-box font-medium">${info.example || "Exemplo técnico."}</div>`;
                    if (key === 'MULTIPLE') html += `<div class="mt-5 flex gap-2">${[3,4,5].map(n => `<button onclick="event.stopPropagation(); STATE.multiRange=${n}; renderTypes();" class="ctrl-btn ${STATE.multiRange===n?'active':''}">I a ${n===3?'III':n===4?'IV':'V'}</button>`).join('')}</div>`;
                    if (key === 'ASSERTION') html += `<div class="mt-4 p-4 bg-slate-50 rounded-2xl text-[10px] font-bold text-inep-700 italic border-l-4 border-inep-500 animate-fade-in">${ASSERTION_LOGIC[STATE.assertionKey]}</div>`;
                }
                div.innerHTML = html; container.appendChild(div);
            });
            lucide.createIcons();
        }

        function setDiff(val) {
            STATE.diff = val;
            document.querySelectorAll('.diff-card').forEach(el => {
                el.classList.remove('active-medium'); const bar = el.querySelector('.diff-bar'); bar.style.backgroundColor = '#e2e8f0';
                if(el.id.includes(val)) { el.classList.add('active-medium'); bar.style.backgroundColor = '#3b82f6'; }
            });
        }

        function setBloom(val) {
            STATE.bloom = val; const info = BLOOM_INFO[val];
            document.querySelectorAll('.bloom-pyramid-btn').forEach(b => { b.classList.remove('active'); if(b.id === `bloom-${val}`) b.classList.add('active'); });
            const box = document.getElementById('bloom-info-box'); box.classList.remove('hidden');
            document.getElementById('bloom-info-title').innerText = val;
            document.getElementById('bloom-info-desc').innerText = info.desc;
            document.getElementById('bloom-info-verbs').innerText = info.verbs;
        }

        function updateQty(n) { STATE.quantity = Math.max(1, Math.min(10, STATE.quantity + n)); document.getElementById('qty-val').innerText = STATE.quantity; }

        function setMode(mode) {
            const isGen = mode === 'generator';
            document.getElementById('tab-gen').className = isGen ? "px-6 py-2.5 rounded-xl text-xs font-black bg-white shadow-lg text-inep-700 transition-all uppercase" : "px-6 py-2.5 rounded-xl text-xs font-black text-slate-500 hover:text-slate-800 transition-all uppercase";
        }

        async function gerar() {
            const btn = document.getElementById('btn-main'); const curso = document.getElementById('curso').value; const conteudo = document.getElementById('conteudo').value;
            if(!curso || !conteudo) return alert("Erro: Preencha os campos.");
            btn.innerHTML = 'Construindo Questão Profissional...'; btn.disabled = true;

            let promptExtras = "";
            if (STATE.type === 'DISCURSIVE') promptExtras = `ESTRUTURA: Itens a), b) e c) em linhas separadas. GRADE DE CORREÇÃO: Título centralizado e negrito: <div style="text-align:center; font-weight:bold; margin-top:30px; text-transform:uppercase;">GRADE DE CORREÇÃO</div>. ITENS DA GRADE: "Critério - Descrição" sem pontos numéricos.`;
            if (STATE.type === 'ASSERTION') promptExtras = `COMANDOS: Termine com PONTO FINAL (.). O PORQUE deve vir centralizado: <div style="text-align:center; font-weight:bold; margin:15px 0;">PORQUE</div>.`;
            if (STATE.type === 'INCOMPLETE') promptExtras = `REGRA CRÍTICA: O enunciado deve terminar de forma incompleta, SEM ponto final. As alternativas devem completar o sentido da frase e começar com letra minúscula.`;

            const prompt = `Atue como Especialista INEP. NUNCA use vocativos ou rótulos administrativos. DIFICULDADE: ${STATE.diff}. Curso: ${curso}. Tema: ${conteudo}. Bloom: ${STATE.bloom}. QUANTIDADE: Gere EXATAMENTE ${STATE.quantity} questões completas. 

            REGRAS DE FORMATAÇÃO:
            1. SEM rótulos como "Texto de suporte:", "Comando:", "Itens:".
            2. ITENS/ALTERNATIVAS: Sempre em linhas separadas (um abaixo do outro).
            3. QUESTÃO DISCURSIVA: Obrigatoriamente com os tópicos a), b) e c).
            4. TEXTO BASE: +500 caracteres profundos.
            5. FONTE: Bibliografia real abaixo do texto suporte em HTML: <strong>Fonte:</strong> [Referência].
            6. EXPLICAÇÃO: Justificativa técnica profunda no final.
            
            SAÍDA: (Texto suporte). (Fonte HTML). (Comando). (Alternativas/Itens). (Grade de Correção). (Explicação Pedagógica). Separe por "---".`;

            try {
                const res = await fetch('/api/gemini', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ prompt }) });
                const data = await res.json();
                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('output').classList.remove('hidden');
                document.getElementById('tools').classList.remove('opacity-0');
                document.getElementById('output').innerHTML = marked.parse(data.text);
            } catch(e) { alert("Erro na API."); } finally { btn.innerHTML = 'Gerar Questão Studio Pro'; btn.disabled = false; }
        }

        function exportWord() {
            const text = document.getElementById('output').innerText;
            const lines = text.split('\n');
            const doc = new docx.Document({
                sections: [{
                    children: lines.map(line => new docx.Paragraph({
                        children: [new docx.TextRun({ text: line, size: 24, font: "Arial" })],
                        spacing: { after: 200 }
                    }))
                }]
            });
            docx.Packer.toBlob(doc).then(blob => saveAs(blob, "Relatorio_StudioPro.docx"));
        }

        function exportPdf() {
            const el = document.getElementById('output');
            html2pdf().set({ margin: 20, filename: 'Relatorio_StudioPro.pdf', image: { type: 'jpeg', quality: 1 }, html2canvas: { scale: 3 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } }).from(el).save();
        }

        init();
    </script>
</body>
</html>
