<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academicus AI | N√∫cleo de Apoio Pedag√≥gico</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        /* UI Elements */
        .input-field { transition: all 0.2s; }
        .input-field:focus { box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); border-color: #2563eb; }
        .bloom-btn { transition: all 0.2s; border: 1px solid #e2e8f0; }
        .bloom-btn:hover { transform: scale(1.01); }
        .type-card { transition: all 0.3s ease; border: 1px solid #e2e8f0; cursor: pointer; }
        .type-card:hover { border-color: #93c5fd; }
        .type-card.active { border-color: #2563eb; background-color: white; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.15); ring: 1px ring-color: #2563eb; }
        .card-content { max-height: 0; opacity: 0; overflow: hidden; transition: all 0.4s ease; }
        .type-card.active .card-content { max-height: 1500px; opacity: 1; margin-top: 16px; padding-top: 16px; border-top: 1px solid #f1f5f9; }
        .diff-card { transition: all 0.2s; cursor: pointer; }
        .diff-bar { transition: all 0.3s ease; }

        /* --- ESTILO DA PROVA (O SEGREDO DA FORMATA√á√ÉO) --- */
        .prose { color: #334155; max-width: none; }
        .prose h3 { 
            color: #1e3a8a; 
            font-size: 1.1rem; 
            border-bottom: 2px solid #e2e8f0; 
            padding-bottom: 0.5rem; 
            margin-top: 2rem; 
            margin-bottom: 1rem; 
            font-weight: 800; 
            text-transform: uppercase; 
            letter-spacing: 0.05em;
        }
        .prose strong { color: #0f172a; font-weight: 700; }
        .prose p { margin-bottom: 1rem; line-height: 1.7; text-align: justify; }
        
        /* Lista de Alternativas Limpa */
        .prose ul { list-style: none; padding-left: 0; }
        .prose li { 
            margin-bottom: 0.8rem; 
            padding: 0.8rem; 
            border: 1px solid #f1f5f9;
            border-radius: 8px;
            background-color: #fff;
            transition: background 0.2s;
        }
        .prose li:hover { background-color: #f8fafc; }
        
        /* CAIXA DE GABARITO PROFISSIONAL */
        .gabarito-box {
            background-color: #f0fdf4;
            border: 1px solid #86efac;
            border-left: 5px solid #16a34a;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            page-break-inside: avoid;
        }
        .gabarito-title {
            color: #166534;
            font-weight: 800;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 1px solid #bbf7d0;
            padding-bottom: 0.5rem;
        }
        
        /* CAIXA DE AUDITORIA (VERMELHA/AMARELA) */
        .audit-box {
            background-color: #fff1f2;
            border: 1px solid #fecdd3;
            border-left: 5px solid #e11d48;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .audit-ok { color: #16a34a; font-weight: bold; }
        .audit-warn { color: #ca8a04; font-weight: bold; }
        .audit-fail { color: #dc2626; font-weight: bold; }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-900">

    <header class="bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-50 flex items-center justify-between shadow-sm no-print">
        <div class="flex items-center gap-3">
            <div class="bg-brand-600 p-2 rounded-lg text-white shadow-md"><i data-lucide="graduation-cap"></i></div>
            <div>
                <h1 class="text-xl font-bold text-slate-900 leading-none">Academicus AI</h1>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">N√∫cleo de Apoio Pedag√≥gico</p>
            </div>
        </div>
        <div class="bg-blue-50 text-blue-700 px-3 py-1.5 rounded-full border border-blue-100 font-bold text-[10px] flex items-center gap-2">
            <i data-lucide="sparkles" class="w-3 h-3"></i> Powered by Gemini 2.0
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1 w-full">
        
        <aside class="lg:col-span-4 xl:col-span-3 space-y-6 no-print">
            
            <div class="bg-slate-200/50 p-1 rounded-xl flex gap-1 font-bold">
                <button onclick="setMode('generator')" id="tab-gen" class="flex-1 py-2.5 text-[11px] rounded-lg flex items-center justify-center gap-2 bg-white text-brand-700 shadow-sm transition-all">
                    <i data-lucide="pen-tool" class="w-3.5 h-3.5"></i> Design
                </button>
                <button onclick="setMode('auditor')" id="tab-aud" class="flex-1 py-2.5 text-[11px] rounded-lg flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 transition-all">
                    <i data-lucide="clipboard-check" class="w-3.5 h-3.5"></i> Auditoria
                </button>
            </div>

            <div id="panel-generator" class="bg-white rounded-2xl border border-slate-200 shadow-sm p-5 space-y-6">
                <div>
                    <h3 class="flex items-center gap-2 text-sm font-bold text-slate-800 mb-4">
                        <i data-lucide="sliders-horizontal" class="w-4 h-4 text-brand-600"></i> Par√¢metros
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 mb-1.5 uppercase">Curso</label>
                            <input type="text" id="curso" class="input-field w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-sm outline-none placeholder:text-slate-400" placeholder="Ex: Psicologia, Direito...">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 mb-1.5 uppercase">Objeto de Conhecimento</label>
                            <textarea id="conteudo" rows="3" class="input-field w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-sm outline-none placeholder:text-slate-400" placeholder="Ex: Terapia Cognitivo-Comportamental..."></textarea>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-xl border border-slate-200">
                            <label class="block text-[10px] font-bold text-slate-400 mb-1.5 uppercase flex items-center gap-1">
                                <i data-lucide="target" class="w-3 h-3"></i> Objetivo (Opcional)
                            </label>
                            <input type="text" id="objetivo" class="w-full bg-transparent text-xs outline-none text-slate-700 placeholder:text-slate-300" placeholder="Ex: Analisar criticamente...">
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">N√≠vel de Dificuldade</label>
                    <div class="grid grid-cols-3 gap-3 h-16">
                        <button onclick="setDiff('F√°cil')" id="diff-F√°cil" class="diff-card w-full h-full rounded-lg border border-slate-200 bg-white flex flex-col justify-center items-center"><span class="text-xs font-bold text-slate-400">F√°cil</span></button>
                        <button onclick="setDiff('M√©dio')" id="diff-M√©dio" class="diff-card w-full h-full rounded-lg border border-brand-300 bg-brand-50 flex flex-col justify-center items-center"><span class="text-xs font-bold text-brand-600">M√©dio</span></button>
                        <button onclick="setDiff('Dif√≠cil')" id="diff-Dif√≠cil" class="diff-card w-full h-full rounded-lg border border-slate-200 bg-white flex flex-col justify-center items-center"><span class="text-xs font-bold text-slate-400">Dif√≠cil</span></button>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-slate-500 mb-2 uppercase">N√≠vel Cognitivo (Bloom)</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="setBloom('Lembrar')" id="btn-Lembrar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Lembrar</button>
                        <button onclick="setBloom('Entender')" id="btn-Entender" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Entender</button>
                        <button onclick="setBloom('Aplicar')" id="btn-Aplicar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Aplicar</button>
                        <button onclick="setBloom('Analisar')" id="btn-Analisar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Analisar</button>
                        <button onclick="setBloom('Avaliar')" id="btn-Avaliar" class="bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white">Avaliar</button>
                        <button onclick="setBloom('Criar')" id="btn-Criar" class="bloom-btn py-2 rounded text-[10px] font-bold bg-indigo-50 text-indigo-700 border-indigo-200">Criar</button>
                    </div>
                </div>

                <div class="pt-4 border-t border-slate-100">
                    <label class="block text-[10px] font-bold text-slate-500 uppercase mb-3">Modelo da Quest√£o</label>
                    <div id="types-container" class="space-y-3"></div>
                </div>

                <button onclick="gerar()" id="btn-main" class="w-full bg-brand-600 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 transition-all hover:bg-brand-700 shadow-lg shadow-brand-200/50 mt-4">
                    <span>Gerar Quest√£o</span>
                    <i data-lucide="zap" class="w-4 h-4"></i>
                </button>
            </div>

            <div id="panel-auditor" class="hidden bg-white rounded-2xl border border-slate-200 shadow-sm p-6 space-y-4">
                <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100 flex gap-3">
                    <i data-lucide="microscope" class="w-5 h-5 text-emerald-600 shrink-0"></i>
                    <div>
                        <h4 class="text-xs font-bold text-emerald-800">Auditoria T√©cnica INEP</h4>
                        <p class="text-[10px] text-emerald-700 mt-1">Cole uma quest√£o para an√°lise psicom√©trica e t√©cnica.</p>
                    </div>
                </div>
                <textarea id="audit-input" rows="15" class="w-full px-4 py-3 rounded-xl border border-emerald-100 bg-emerald-50/20 text-xs font-mono outline-none focus:border-emerald-500 text-slate-700" placeholder="Cole a quest√£o completa aqui (Enunciado + Alternativas)..."></textarea>
                <button onclick="auditar()" id="btn-aud" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2">
                    <span>Executar Auditoria</span>
                    <i data-lucide="check-circle-2" class="w-4 h-4"></i>
                </button>
            </div>
        </aside>

        <div class="lg:col-span-8 xl:col-span-9 flex flex-col h-full">
            <div id="result-area" class="bg-white min-h-[850px] rounded-[2rem] border border-slate-200 shadow-sm flex flex-col relative overflow-hidden transition-all">
                
                <div id="export-tools" class="hidden absolute top-6 right-6 flex gap-2 z-20 no-print">
                    <button onclick="exportWord()" class="bg-white border border-slate-200 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-50 text-xs font-bold shadow-sm flex items-center gap-2">
                        <i data-lucide="file-text" class="w-4 h-4"></i> Word
                    </button>
                    <button onclick="exportPDF()" class="bg-white border border-slate-200 text-red-700 px-4 py-2 rounded-lg hover:bg-red-50 text-xs font-bold shadow-sm flex items-center gap-2">
                        <i data-lucide="file-type-2" class="w-4 h-4"></i> PDF
                    </button>
                </div>

                <div id="placeholder" class="flex-1 flex flex-col items-center justify-center text-center p-12">
                    <div class="bg-slate-50 p-6 rounded-full mb-6 ring-1 ring-slate-100"><i data-lucide="pen-tool" class="w-10 h-10 text-slate-300"></i></div>
                    <h3 class="text-lg font-bold text-slate-400">√Årea de Cria√ß√£o & An√°lise</h3>
                    <p class="text-slate-400 text-sm mt-2">Use as abas √† esquerda para alternar entre<br>Criar Quest√µes e Auditar Quest√µes.</p>
                </div>
                
                <div id="ai-output" class="hidden text-left w-full max-w-4xl mx-auto p-12 prose prose-slate"></div>
            </div>
        </div>
    </main>

    <script>
        // --- DADOS E TIPOS ---
        const TYPES = {
            "SINGLE": { title: "Resposta √önica", icon: "check-circle", desc: "Cl√°ssica m√∫ltipla escolha (A-E)." },
            "MULTIPLE": { title: "Complementa√ß√£o M√∫ltipla", icon: "layers", desc: "Itens Romanos (I, II, III) com somat√≥ria." },
            "ASSERTION": { title: "Asser√ß√£o e Raz√£o", icon: "git-compare", desc: "Duas afirma√ß√µes conectadas por PORQUE." },
            "DISCURSIVE": { title: "Discursiva", icon: "align-left", desc: "Quest√£o aberta com padr√£o de resposta." }
        };

        let state = {
            mode: 'generator',
            type: 'SINGLE',
            bloom: 'Criar',
            difficulty: 'M√©dio',
            multiRange: 4,
            assertionKey: 'A'
        };

        // --- UI UTILS ---
        function setMode(mode) {
            state.mode = mode;
            const isGen = mode === 'generator';
            document.getElementById('panel-generator').classList.toggle('hidden', !isGen);
            document.getElementById('panel-auditor').classList.toggle('hidden', isGen);
            
            // Estilo das abas
            document.getElementById('tab-gen').className = isGen ? 'flex-1 py-2.5 text-[11px] rounded-lg flex items-center justify-center gap-2 bg-white text-brand-700 shadow-sm transition-all font-bold' : 'flex-1 py-2.5 text-[11px] rounded-lg flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 transition-all';
            document.getElementById('tab-aud').className = !isGen ? 'flex-1 py-2.5 text-[11px] rounded-lg flex items-center justify-center gap-2 bg-white text-emerald-700 shadow-sm transition-all font-bold' : 'flex-1 py-2.5 text-[11px] rounded-lg flex items-center justify-center gap-2 text-slate-500 hover:text-slate-700 transition-all';
        }

        function renderTypes() {
            const container = document.getElementById('types-container');
            container.innerHTML = '';

            Object.entries(TYPES).forEach(([key, info]) => {
                const active = state.type === key;
                const card = document.createElement('div');
                card.className = `type-card p-4 rounded-xl bg-white ${active ? 'active' : 'border-slate-200'}`;
                card.onclick = () => { state.type = key; renderTypes(); };

                // Controles extras para tipos complexos
                let extraControls = '';
                if (key === 'MULTIPLE' && active) {
                    extraControls = `
                        <div class="mt-3 pt-3 border-t border-slate-100 flex gap-2">
                            ${[3,4,5].map(n => `<button onclick="event.stopPropagation(); state.multiRange=${n}; renderTypes();" class="px-2 py-1 text-[10px] font-bold border rounded ${state.multiRange===n ? 'bg-brand-600 text-white' : 'bg-white text-slate-500'}">I a ${n===3?'III':n===4?'IV':'V'}</button>`).join('')}
                        </div>`;
                }
                if (key === 'ASSERTION' && active) {
                    extraControls = `
                        <div class="mt-3 pt-3 border-t border-slate-100 flex gap-2">
                            ${['A','B','C','D','E'].map(l => `<button onclick="event.stopPropagation(); state.assertionKey='${l}'; renderTypes();" class="w-6 h-6 flex items-center justify-center text-[10px] font-bold border rounded ${state.assertionKey===l ? 'bg-brand-600 text-white' : 'bg-white text-slate-500'}">${l}</button>`).join('')}
                        </div>`;
                }

                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="${active?'text-brand-600':'text-slate-400'}"><i data-lucide="${info.icon}" class="w-5 h-5"></i></div>
                            <span class="text-xs font-bold ${active?'text-brand-700':'text-slate-600'}">${info.title}</span>
                        </div>
                        ${active ? '<i data-lucide="check" class="w-4 h-4 text-brand-600"></i>' : ''}
                    </div>
                    <div class="card-content">
                        <p class="text-[10px] text-slate-500 leading-relaxed">${info.desc}</p>
                        ${extraControls}
                    </div>
                `;
                container.appendChild(card);
            });
            lucide.createIcons();
        }

        // --- SELETORES DE ESTADO ---
        function setDiff(val) {
            ['F√°cil', 'M√©dio', 'Dif√≠cil'].forEach(l => {
                document.getElementById(`diff-${l}`).className = 'diff-card w-full h-full rounded-lg border border-slate-200 bg-white flex flex-col justify-center items-center text-slate-400';
            });
            const active = document.getElementById(`diff-${val}`);
            active.className = 'diff-card w-full h-full rounded-lg border border-brand-500 bg-brand-50 flex flex-col justify-center items-center text-brand-700 ring-1 ring-brand-500';
            state.difficulty = val;
        }

        function setBloom(val) {
            document.querySelectorAll('.bloom-btn').forEach(b => b.className = 'bloom-btn py-2 rounded text-[10px] text-slate-600 bg-white');
            const btn = document.getElementById(`btn-${val}`);
            btn.className = 'bloom-btn py-2 rounded text-[10px] font-bold bg-indigo-50 text-indigo-700 border-indigo-200 ring-1 ring-indigo-300';
            state.bloom = val;
        }

        // --- FUN√á√ÉO GERAR (PROMPT BLINDADO PARA FORMATA√á√ÉO) ---
        async function gerar() {
            const curso = document.getElementById('curso').value;
            const conteudo = document.getElementById('conteudo').value;
            const objetivo = document.getElementById('objetivo').value;
            
            if (!curso || !conteudo) return alert("Preencha Curso e Objeto de Conhecimento.");

            const btn = document.getElementById('btn-main');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Processando...`;
            btn.disabled = true;

            // CONFIGURA√á√ÉO T√âCNICA DO PROMPT
            let extras = "";
            let specificConstraint = "";
            
            if (state.type === 'MULTIPLE') {
                extras = `ITENS ROMANOS OBRIGAT√ìRIOS: I a ${state.multiRange===3?'III':state.multiRange===4?'IV':'V'}.`;
            }
            
            // CORRE√á√ÉO CR√çTICA PARA ASSER√á√ÉO E RAZ√ÉO
            if (state.type === 'ASSERTION') {
                extras = `
                REGRA CR√çTICA PARA ASSER√á√ÉO E RAZ√ÉO:
                1. Voc√™ deve gerar a 'Asser√ß√£o I' e a 'Asser√ß√£o II' ligadas pela palavra PORQUE.
                2. O Gabarito deve ser a Letra ${state.assertionKey}.
                3. AS ALTERNATIVAS S√ÉO FIXAS. COPIE EXATAMENTE ESTE TEXTO PARA AS ALTERNATIVAS:
                   A) As asser√ß√µes I e II s√£o proposi√ß√µes verdadeiras, e a II √© uma justificativa correta da I.
                   B) As asser√ß√µes I e II s√£o proposi√ß√µes verdadeiras, mas a II n√£o √© uma justificativa correta da I.
                   C) A asser√ß√£o I √© uma proposi√ß√£o verdadeira, e a II √© uma proposi√ß√£o falsa.
                   D) A asser√ß√£o I √© uma proposi√ß√£o falsa, e a II √© uma proposi√ß√£o verdadeira.
                   E) As asser√ß√µes I e II s√£o proposi√ß√µes falsas.
                `;
            }

            // O PROMPT "VISUAL"
            const prompt = `
            ATUE COMO ESPECIALISTA DO INEP/ENADE.
            Crie uma quest√£o in√©dita seguindo estritamente este comando.
            
            DADOS:
            - Tipo: ${TYPES[state.type].title}
            - Curso: ${curso}
            - T√≥pico: ${conteudo}
            - Bloom: ${state.bloom}
            - Dificuldade: ${state.difficulty}
            ${extras}
            
            ---
            
            FORMATO DE SA√çDA OBRIGAT√ìRIO (MARKDOWN + HTML):
            N√£o escreva introdu√ß√µes. Siga este template visual EXATAMENTE:

            ### Enunciado
            (Texto base rico e contextualizado, seguido do comando da quest√£o em negrito).

            ### Alternativas
            (Liste as alternativas aqui. Se for Asser√ß√£o e Raz√£o, use as fixas que eu mandei acima).

            <div class="gabarito-box">
            <div class="gabarito-title"><i data-lucide="check-circle-2"></i> GABARITO E AN√ÅLISE</div>
            <div class="gabarito-content">
            <p><strong>‚úÖ Resposta Correta:</strong> (Letra)</p>
            <p><strong>üí° Justificativa Pedag√≥gica:</strong> (Explica√ß√£o t√©cnica detalhada sobre a resposta).</p>
            </div>
            </div>
            `;

            executeAI(prompt, btn, originalHTML);
        }

        // --- FUN√á√ÉO AUDITAR (NOVO PROMPT REVISADO) ---
        async function auditar() {
            const input = document.getElementById('audit-input').value;
            if (!input) return alert("Cole a quest√£o para auditar.");

            const btn = document.getElementById('btn-aud');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Auditando...`;
            btn.disabled = true;

            const prompt = `
            ATUE COMO AUDITOR S√äNIOR DO INEP/ENADE.
            Analise rigorosamente a quest√£o abaixo procurando falhas t√©cnicas, vi√©s ou erros de constru√ß√£o.
            
            QUEST√ÉO PARA AN√ÅLISE:
            ${input}

            ---

            FORMATO DE SA√çDA OBRIGAT√ìRIO (MARKDOWN + HTML):
            
            ### Relat√≥rio de Auditoria T√©cnica

            <div class="audit-box">
            <h4>1. An√°lise do Enunciado</h4>
            <ul style="list-style:none; padding:0;">
                <li>(Use emoji ‚úÖ ou ‚ö†Ô∏è) <strong>Contextualiza√ß√£o:</strong> (Avalie se o texto base √© pertinente)</li>
                <li>(Use emoji ‚úÖ ou ‚ö†Ô∏è) <strong>Clareza do Comando:</strong> (Avalie se o comando √© direto e sem ambiguidade)</li>
            </ul>

            <h4>2. An√°lise das Alternativas</h4>
            <ul style="list-style:none; padding:0;">
                <li>(Use emoji ‚úÖ ou ‚ö†Ô∏è) <strong>Plausibilidade dos Distratores:</strong> (Os erros s√£o inteligentes ou √≥bvios demais?)</li>
                <li>(Use emoji ‚úÖ ou ‚ö†Ô∏è) <strong>Paralelismo:</strong> (As alternativas t√™m tamanho e estrutura gramatical similar?)</li>
                <li>(Use emoji ‚úÖ ou ‚ö†Ô∏è) <strong>Pegadinhas:</strong> (Existe alguma casca de banana desleal?)</li>
            </ul>

            <h4>3. Veredito Final</h4>
            <p>(D√™ um parecer conclusivo: A quest√£o est√° APROVADA, REQUER AJUSTES ou REJEITADA, e explique o porqu√™ em 2 linhas).</p>
            </div>
            `;

            executeAI(prompt, btn, originalHTML);
        }

        async function executeAI(prompt, btn, originalHTML) {
            try {
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ prompt })
                });
                
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);

                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('export-tools').classList.remove('hidden');
                const output = document.getElementById('ai-output');
                output.classList.remove('hidden');
                output.innerHTML = marked.parse(data.text); 
                lucide.createIcons();

            } catch (error) {
                alert("Erro: " + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalHTML;
                lucide.createIcons();
            }
        }

        // --- EXPORTA√á√ÉO ---
        async function exportWord() {
            const { Document, Packer, Paragraph, TextRun } = docx;
            const text = document.getElementById('ai-output').innerText; 
            const doc = new Document({ sections: [{ children: [new Paragraph({ children: [new TextRun({text: "Academicus AI - Relat√≥rio", bold: true, size: 32}), new TextRun({text: "\n\n"+text, size: 24})]})]}]});
            const blob = await Packer.toBlob(doc);
            saveAs(blob, "Questao_Academicus.docx");
        }

        function exportPDF() {
            const el = document.getElementById('ai-output');
            html2pdf().set({ margin: 1, filename: 'Academicus.pdf' }).from(el).save();
        }

        // Inicializa√ß√£o
        renderTypes();
        lucide.createIcons();
    </script>
</body>
</html>
