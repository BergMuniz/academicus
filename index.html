<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academicus AI | Plataforma Desktop</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' },
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { background-color: #f8fafc; color: #0f172a; }
        
        /* Sidebar Fixa e Inputs */
        .sidebar-scroll { scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent; }
        .input-classic { 
            width: 100%; 
            padding: 0.75rem 1rem; 
            background-color: #f8fafc; 
            border: 1px solid #e2e8f0; 
            border-radius: 0.5rem; 
            font-size: 0.875rem; 
            transition: all 0.2s;
        }
        .input-classic:focus { 
            background-color: #fff; 
            border-color: #0284c7; 
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1); 
            outline: none; 
        }

        /* Cards de Sele√ß√£o */
        .select-card { 
            border: 1px solid #e2e8f0; 
            border-radius: 0.75rem; 
            padding: 1rem; 
            cursor: pointer; 
            transition: all 0.2s; 
            background: white;
            position: relative;
        }
        .select-card:hover { border-color: #bae6fd; }
        .select-card.active { 
            border-color: #0284c7; 
            background-color: #f0f9ff; 
            box-shadow: 0 4px 6px -1px rgba(2, 132, 199, 0.1); 
        }
        .check-icon { display: none; position: absolute; top: 1rem; right: 1rem; color: #0284c7; }
        .select-card.active .check-icon { display: block; }

        /* --- √ÅREA DE RESULTADO (PAPEL) --- */
        .paper-shadow { 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01); 
            border: 1px solid #e2e8f0;
        }

        /* --- TIPOGRAFIA DA QUEST√ÉO --- */
        .prose h3 { 
            color: #0c4a6e; 
            font-size: 1.25rem; 
            border-bottom: 2px solid #e0f2fe; 
            padding-bottom: 0.5rem; 
            margin-top: 2rem; 
            margin-bottom: 1rem; 
            font-weight: 700; 
        }
        .prose strong { color: #0f172a; font-weight: 700; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; text-align: justify; }
        .prose ul { list-style: none; padding: 0; }
        .prose li { 
            margin-bottom: 0.75rem; 
            padding: 1rem; 
            border: 1px solid #f1f5f9; 
            border-radius: 0.5rem; 
            background: #fff;
        }

        /* --- CAIXA DE GABARITO (VERDE) --- */
        .gabarito-box {
            background-color: #f0fdf4;
            border: 1px solid #86efac;
            border-left: 5px solid #16a34a;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 3rem;
        }
        .gabarito-title {
            color: #166534;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            display: flex; align-items: center; gap: 0.5rem;
        }

        /* --- CAIXA DE AUDITORIA (VERMELHA/AMARELA) --- */
        .audit-box {
            background-color: #fff1f2;
            border: 1px solid #fecdd3;
            border-left: 5px solid #e11d48;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col font-sans text-slate-900">

    <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-8 fixed top-0 w-full z-50 shadow-sm no-print">
        <div class="flex items-center gap-3">
            <div class="bg-brand-600 p-2 rounded-lg text-white shadow-lg shadow-brand-500/30">
                <i data-lucide="graduation-cap" class="w-5 h-5"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-slate-900 leading-none">Academicus AI</h1>
                <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-0.5">N√∫cleo de Apoio Pedag√≥gico</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-xs font-medium text-slate-500 bg-slate-100 px-3 py-1.5 rounded-full border border-slate-200">
                v2.1 Desktop
            </div>
            <div class="flex bg-slate-100 p-1 rounded-lg">
                <button onclick="switchMode('generator')" id="btn-mode-gen" class="px-4 py-1.5 text-xs font-bold rounded-md bg-white text-brand-700 shadow-sm transition-all">Criar</button>
                <button onclick="switchMode('auditor')" id="btn-mode-aud" class="px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-700 transition-all">Auditar</button>
            </div>
        </div>
    </header>

    <div class="pt-16 min-h-screen flex">
        
        <aside class="w-96 bg-white border-r border-slate-200 h-[calc(100vh-4rem)] fixed left-0 overflow-y-auto sidebar-scroll p-6 space-y-8 shadow-[4px_0_24px_-12px_rgba(0,0,0,0.1)] z-40 no-print">
            
            <div id="panel-generator" class="space-y-8 animate-fade-in">
                <div class="space-y-4">
                    <div class="flex items-center gap-2 text-slate-800 font-bold text-sm border-b border-slate-100 pb-2">
                        <i data-lucide="database" class="w-4 h-4 text-brand-500"></i> Contexto da Quest√£o
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Curso / Disciplina</label>
                        <input type="text" id="curso" class="input-classic" placeholder="Ex: Psicologia, Direito Civil...">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Objeto de Conhecimento</label>
                        <textarea id="conteudo" rows="3" class="input-classic resize-none" placeholder="Ex: Teoria Cognitivo-Comportamental..."></textarea>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center gap-2 text-slate-800 font-bold text-sm border-b border-slate-100 pb-2">
                        <i data-lucide="layout-template" class="w-4 h-4 text-brand-500"></i> Modelo
                    </div>
                    <div id="types-container" class="space-y-3">
                        </div>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center gap-2 text-slate-800 font-bold text-sm border-b border-slate-100 pb-2">
                        <i data-lucide="sliders" class="w-4 h-4 text-brand-500"></i> Calibragem
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Dificuldade</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setDiff('F√°cil')" id="diff-F√°cil" class="py-2 rounded-md text-xs font-medium border border-slate-200 hover:bg-slate-50">F√°cil</button>
                            <button onclick="setDiff('M√©dio')" id="diff-M√©dio" class="py-2 rounded-md text-xs font-bold bg-brand-50 text-brand-700 border border-brand-200">M√©dio</button>
                            <button onclick="setDiff('Dif√≠cil')" id="diff-Dif√≠cil" class="py-2 rounded-md text-xs font-medium border border-slate-200 hover:bg-slate-50">Dif√≠cil</button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Taxonomia de Bloom</label>
                        <select id="bloom" class="input-classic cursor-pointer">
                            <option value="Lembrar">Lembrar (Conhecimento)</option>
                            <option value="Entender">Entender (Compreens√£o)</option>
                            <option value="Aplicar">Aplicar (Aplica√ß√£o)</option>
                            <option value="Analisar">Analisar (An√°lise)</option>
                            <option value="Avaliar">Avaliar (Avalia√ß√£o)</option>
                            <option value="Criar" selected>Criar (S√≠ntese)</option>
                        </select>
                    </div>
                </div>

                <button onclick="gerar()" id="btn-gerar" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-brand-500/30 flex items-center justify-center gap-2 transition-all transform active:scale-95">
                    <span>Gerar Quest√£o</span>
                    <i data-lucide="zap" class="w-4 h-4"></i>
                </button>
            </div>

            <div id="panel-auditor" class="hidden space-y-6 animate-fade-in">
                <div class="bg-amber-50 border border-amber-100 p-4 rounded-xl flex gap-3">
                    <i data-lucide="shield-alert" class="w-5 h-5 text-amber-600 shrink-0"></i>
                    <div>
                        <h4 class="text-sm font-bold text-amber-900">Modo Auditoria</h4>
                        <p class="text-xs text-amber-700 mt-1">Cole uma quest√£o completa para an√°lise de vi√©s, falhas t√©cnicas e conformidade com o INEP.</p>
                    </div>
                </div>
                <textarea id="audit-input" rows="15" class="input-classic font-mono text-xs resize-none" placeholder="Cole a quest√£o aqui (Enunciado + Alternativas)..."></textarea>
                <button onclick="auditar()" id="btn-auditar" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-amber-500/30 flex items-center justify-center gap-2 transition-all">
                    <span>Executar Auditoria</span>
                    <i data-lucide="search" class="w-4 h-4"></i>
                </button>
            </div>
        </aside>

        <main class="ml-96 flex-1 p-8 lg:p-12 flex flex-col items-center bg-slate-50/50">
            
            <div id="result-container" class="w-full max-w-4xl bg-white min-h-[800px] rounded-2xl paper-shadow p-12 relative transition-all">
                
                <div id="tools" class="absolute top-6 right-6 flex gap-2 opacity-0 pointer-events-none transition-opacity duration-300 no-print">
                    <button onclick="exportWord()" class="flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg hover:bg-blue-50 text-blue-700 text-xs font-bold transition-colors">
                        <i data-lucide="file-text" class="w-4 h-4"></i> Word
                    </button>
                    <button onclick="exportPDF()" class="flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg hover:bg-red-50 text-red-700 text-xs font-bold transition-colors">
                        <i data-lucide="file-check" class="w-4 h-4"></i> PDF
                    </button>
                </div>

                <div id="placeholder" class="h-full flex flex-col items-center justify-center text-center mt-32 opacity-50">
                    <div class="bg-slate-100 p-6 rounded-full mb-6">
                        <i data-lucide="pen-tool" class="w-12 h-12 text-slate-300"></i>
                    </div>
                    <h2 class="text-xl font-bold text-slate-400">√Årea de Trabalho</h2>
                    <p class="text-slate-400 mt-2">Configure os par√¢metros na esquerda<br>para gerar seu conte√∫do aqui.</p>
                </div>

                <div id="output" class="hidden prose prose-slate max-w-none animate-fade-in"></div>
            </div>

            <footer class="mt-8 text-slate-400 text-xs font-medium no-print">
                &copy; 2026 Academicus AI. Processamento via Vercel Edge Functions.
            </footer>
        </main>
    </div>

    <script>
        // --- ESTADO GLOBAL ---
        const STATE = {
            mode: 'generator', // generator | auditor
            type: 'SINGLE',
            difficulty: 'M√©dio',
            multiRange: 4,
            assertionKey: 'A'
        };

        const TYPES = {
            "SINGLE": { title: "Resposta √önica", icon: "check-circle", desc: "Cl√°ssica (A-E)" },
            "MULTIPLE": { title: "Compl. M√∫ltipla", icon: "layers", desc: "Romanos (I, II, III)" },
            "ASSERTION": { title: "Asser√ß√£o-Raz√£o", icon: "git-compare", desc: "PORQUE" },
            "DISCURSIVE": { title: "Discursiva", icon: "align-left", desc: "Aberta" }
        };

        // --- RENDERIZA√á√ÉO ---
        function init() {
            renderTypes();
            lucide.createIcons();
        }

        function switchMode(mode) {
            STATE.mode = mode;
            const isGen = mode === 'generator';
            
            document.getElementById('panel-generator').classList.toggle('hidden', !isGen);
            document.getElementById('panel-auditor').classList.toggle('hidden', isGen);
            
            // Toggle Bot√µes Header
            const btnGen = document.getElementById('btn-mode-gen');
            const btnAud = document.getElementById('btn-mode-aud');
            
            if(isGen) {
                btnGen.className = "px-4 py-1.5 text-xs font-bold rounded-md bg-white text-brand-700 shadow-sm transition-all";
                btnAud.className = "px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-700 transition-all";
            } else {
                btnGen.className = "px-4 py-1.5 text-xs font-bold rounded-md text-slate-500 hover:text-slate-700 transition-all";
                btnAud.className = "px-4 py-1.5 text-xs font-bold rounded-md bg-white text-amber-700 shadow-sm transition-all";
            }
        }

        function renderTypes() {
            const container = document.getElementById('types-container');
            container.innerHTML = '';

            Object.entries(TYPES).forEach(([key, info]) => {
                const active = STATE.type === key;
                const div = document.createElement('div');
                div.className = `select-card ${active ? 'active' : ''}`;
                div.onclick = () => { STATE.type = key; renderTypes(); };

                // Controles Extras
                let extras = '';
                if(active && key === 'MULTIPLE') {
                    extras = `<div class="mt-3 pt-3 border-t border-blue-100 flex gap-2">
                        ${[3,4,5].map(n => `<button onclick="event.stopPropagation(); STATE.multiRange=${n}; renderTypes()" class="px-2 py-1 text-[10px] rounded border ${STATE.multiRange===n ? 'bg-brand-500 text-white border-brand-600' : 'bg-white border-slate-200'}">I-${n===3?'III':n===4?'IV':'V'}</button>`).join('')}
                    </div>`;
                }
                if(active && key === 'ASSERTION') {
                    extras = `<div class="mt-3 pt-3 border-t border-blue-100 flex gap-1">
                        ${['A','B','C','D','E'].map(l => `<button onclick="event.stopPropagation(); STATE.assertionKey='${l}'; renderTypes()" class="w-6 h-6 text-[10px] rounded border flex items-center justify-center font-bold ${STATE.assertionKey===l ? 'bg-brand-500 text-white border-brand-600' : 'bg-white border-slate-200'}">${l}</button>`).join('')}
                    </div>`;
                }

                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="${active ? 'text-brand-600' : 'text-slate-400'}"><i data-lucide="${info.icon}" class="w-5 h-5"></i></div>
                        <div>
                            <p class="text-xs font-bold ${active ? 'text-brand-800' : 'text-slate-700'}">${info.title}</p>
                            <p class="text-[10px] text-slate-500">${info.desc}</p>
                        </div>
                    </div>
                    <i data-lucide="check-circle" class="w-4 h-4 check-icon"></i>
                    ${extras}
                `;
                container.appendChild(div);
            });
            lucide.createIcons();
        }

        function setDiff(val) {
            STATE.difficulty = val;
            ['F√°cil', 'M√©dio', 'Dif√≠cil'].forEach(l => {
                const btn = document.getElementById(`diff-${l}`);
                if (l === val) {
                    btn.className = "py-2 rounded-md text-xs font-bold bg-brand-50 text-brand-700 border border-brand-200 ring-1 ring-brand-300";
                } else {
                    btn.className = "py-2 rounded-md text-xs font-medium border border-slate-200 hover:bg-slate-50 text-slate-500";
                }
            });
        }

        // --- INTEGRA√á√ÉO COM BACKEND (API VERCEL) ---
        async function gerar() {
            const curso = document.getElementById('curso').value;
            const conteudo = document.getElementById('conteudo').value;
            const bloom = document.getElementById('bloom').value;

            if (!curso || !conteudo) return alert("Preencha Curso e Conte√∫do.");

            // UI Loading
            const btn = document.getElementById('btn-gerar');
            const originalBtn = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Processando...`;
            btn.disabled = true;

            // Prompt Engineering
            let promptExtras = "";
            if (STATE.type === 'MULTIPLE') promptExtras = `Use itens I a ${STATE.multiRange===3?'III':STATE.multiRange===4?'IV':'V'}.`;
            if (STATE.type === 'ASSERTION') {
                promptExtras = `
                REGRA CR√çTICA DE ESTRUTURA:
                1. Gere Asser√ß√£o I e Asser√ß√£o II ligadas por PORQUE.
                2. O Gabarito deve ser obrigatoriamente a Letra ${STATE.assertionKey}.
                3. USE AS ALTERNATIVAS PADR√ÉO INEP (A=I e II verdadeiras...). N√ÉO INVENTE OUTRAS.
                `;
            }

            const prompt = `
            ATUE COMO ESPECIALISTA DO INEP.
            Crie uma quest√£o t√©cnica e rigorosa para Desktop.
            
            DADOS:
            - Tipo: ${TYPES[STATE.type].title}
            - Curso: ${curso}
            - T√≥pico: ${conteudo}
            - Dificuldade: ${STATE.difficulty}
            - Bloom: ${bloom}
            ${promptExtras}

            FORMATO DE SA√çDA (MARKDOWN + HTML):
            N√£o use introdu√ß√µes. Siga este template:

            ### Enunciado
            (Texto base rico e comando em negrito).

            ### Alternativas
            (Lista formatada).

            <div class="gabarito-box">
            <div class="gabarito-title"><i data-lucide="check-circle-2"></i> GABARITO E AN√ÅLISE</div>
            <p><strong>‚úÖ Resposta Correta:</strong> (Letra)</p>
            <p><strong>üí° Justificativa:</strong> (Explica√ß√£o t√©cnica detalhada).</p>
            </div>
            `;

            await callAPI(prompt, btn, originalBtn);
        }

        async function auditar() {
            const input = document.getElementById('audit-input').value;
            if(!input) return alert("Cole a quest√£o.");

            const btn = document.getElementById('btn-auditar');
            const originalBtn = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Auditando...`;
            btn.disabled = true;

            const prompt = `
            ATUE COMO AUDITOR DO INEP.
            Analise a quest√£o abaixo procurando falhas.
            QUEST√ÉO: ${input}
            
            SA√çDA:
            <div class="audit-box">
            <h4>Relat√≥rio de Auditoria</h4>
            <ul>
            <li><strong>Enunciado:</strong> (An√°lise)</li>
            <li><strong>Alternativas:</strong> (An√°lise)</li>
            <li><strong>Veredito:</strong> APROVADA / REPROVADA</li>
            </ul>
            </div>
            `;

            await callAPI(prompt, btn, originalBtn);
        }

        async function callAPI(prompt, btn, originalHTML) {
            try {
                // Chamada ao seu Backend Vercel existente
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error);

                // Renderiza√ß√£o
                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('tools').classList.remove('opacity-0', 'pointer-events-none');
                
                const output = document.getElementById('output');
                output.classList.remove('hidden');
                output.innerHTML = marked.parse(data.text);
                lucide.createIcons();

            } catch (err) {
                alert("Erro: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalHTML;
                lucide.createIcons();
            }
        }

        // --- EXPORTA√á√ÉO ---
        function exportWord() {
            const text = document.getElementById('output').innerText;
            const doc = new docx.Document({ sections: [{ children: [new docx.Paragraph({ children: [new docx.TextRun(text)] })] }] });
            docx.Packer.toBlob(doc).then(blob => saveAs(blob, "Questao_Academicus.docx"));
        }

        function exportPDF() {
            const element = document.getElementById('output');
            html2pdf().set({ margin: 1, filename: 'Questao_Academicus.pdf' }).from(element).save();
        }

        // Start
        init();
    </script>
</body>
</html>
