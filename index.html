<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Academicus AI | Studio Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        inep: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' },
                        bloomSky: { 100: '#e0f2fe', 800: '#075985', border: '#7dd3fc' },
                        bloomBlue: { 100: '#dbeafe', 800: '#1e40af', border: '#93c5fd' },
                        bloomIndigo: { 100: '#e0e7ff', 800: '#3730a3', border: '#a5b4fc' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { background-color: #f8fafc; color: #1e293b; -webkit-font-smoothing: antialiased; }

        .type-card { border: 1px solid #e2e8f0; border-radius: 20px; background: white; padding: 18px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; }
        .type-card.active { border-color: #0284c7; box-shadow: 0 20px 25px -5px rgba(2, 132, 199, 0.1); }
        .radio-circle { width: 22px; height: 22px; border-radius: 50%; border: 2px solid #cbd5e1; flex-shrink: 0; transition: all 0.2s; }
        .type-card.active .radio-circle { border-color: #0284c7; border-width: 7px; }

        .example-box { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 14px; padding: 16px; margin-top: 14px; font-size: 0.75rem; color: #475569; line-height: 1.7; white-space: pre-wrap; border-left: 5px solid #cbd5e1; }
        .example-header { display: flex; align-items: center; gap: 6px; font-size: 0.7rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.05em; }

        .ctrl-btn { padding: 10px 14px; border-radius: 12px; font-size: 0.75rem; font-weight: 800; border: 1px solid #e2e8f0; background: white; color: #64748b; flex: 1; display: flex; justify-content: center; }
        .ctrl-btn.active { background: #0284c7; border-color: #0284c7; color: white; }

        .key-btn { width: 44px; height: 44px; border-radius: 12px; border: 1px solid #e2e8f0; font-weight: 900; background: white; flex: 1; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .key-btn.active { background: #0284c7; color: white; border-color: #0284c7; transform: translateY(-2px); }

        .bloom-btn { border: 1px solid #e2e8f0; padding: 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 700; text-align: center; color: #64748b; background: white; width: 100%; transition: all 0.3s; }
        .bloom-btn.active.sky { background: #e0f2fe; border-color: #7dd3fc; color: #0369a1; }
        .bloom-btn.active.blue { background: #dbeafe; border-color: #93c5fd; color: #1e40af; }
        .bloom-btn.active.indigo { background: #e0e7ff; border-color: #a5b4fc; color: #3730a3; }

        .prose h3 { color: #0c4a6e; font-size: 1.2rem; font-weight: 900; border-bottom: 3px solid #e0f2fe; margin-top: 2.5rem; margin-bottom: 1.5rem; padding-bottom: 0.6rem; text-transform: uppercase; }
        .prose p { margin-bottom: 1.5rem; line-height: 1.8; text-align: justify; }
        .prose li { display: block; margin-bottom: 1.2rem; }
        .gabarito-box { background: #f0fdf4; border: 1px solid #86efac; border-left: 8px solid #16a34a; padding: 2rem; border-radius: 20px; margin-top: 4rem; }
        
        input, textarea { font-size: 16px !important; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 h-20 flex items-center px-4 lg:px-12 justify-between shadow-sm">
        <div class="flex items-center gap-5">
            <div class="bg-inep-600 p-2.5 rounded-2xl text-white shrink-0 shadow-xl shadow-inep-100"><i data-lucide="graduation-cap" class="w-7 h-7"></i></div>
            <div class="leading-tight">
                <h1 class="text-2xl lg:text-3xl font-black text-slate-900 leading-none tracking-tighter">Academicus AI</h1>
                <p class="text-[11px] font-black text-inep-500 uppercase tracking-[0.2em] mt-1">Studio de Criação de Questões</p>
            </div>
        </div>
        <div class="flex bg-slate-100 p-1.5 rounded-2xl">
            <button onclick="setMode('generator')" id="tab-gen" class="px-6 py-2.5 rounded-xl text-xs font-black bg-white shadow-lg text-inep-700 transition-all uppercase tracking-wider">Design</button>
            <button onclick="setMode('auditor')" id="tab-aud" class="px-6 py-2.5 rounded-xl text-xs font-black text-slate-500 hover:text-slate-800 transition-all uppercase tracking-wider">Auditoria</button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto w-full p-4 lg:p-12 grid grid-cols-1 lg:grid-cols-12 gap-12 flex-1">
        
        <aside class="lg:col-span-5 space-y-10">
            <div id="panel-generator" class="space-y-10">
                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-2xl shadow-slate-200/40 space-y-8">
                    <div class="flex items-center gap-4 pb-5 border-b border-slate-50">
                        <div class="p-3 bg-inep-50 rounded-xl"><i data-lucide="book-open" class="w-6 h-6 text-inep-600"></i></div>
                        <h3 class="text-lg font-black text-slate-800 uppercase tracking-tight">Especificações</h3>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.15em] mb-2.5 block">Curso / Área</label>
                            <input id="curso" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none focus:bg-white focus:border-inep-500 transition-all" placeholder="Curso...">
                        </div>
                        <div>
                            <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.15em] mb-2.5 block">Objeto de Conhecimento</label>
                            <textarea id="conteudo" rows="4" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm resize-none outline-none focus:bg-white focus:border-inep-500 transition-all" placeholder="Tema técnico..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-6">
                    <label class="text-[11px] font-black text-slate-500 uppercase tracking-[0.15em] block">Taxonomia de Bloom</label>
                    <div class="flex flex-col gap-2.5">
                        <button onclick="setBloom('Criar')" id="bloom-Criar" class="bloom-btn">Criar</button>
                        <button onclick="setBloom('Avaliar')" id="bloom-Avaliar" class="bloom-btn">Avaliar</button>
                        <button onclick="setBloom('Analisar')" id="bloom-Analisar" class="bloom-btn">Analisar</button>
                        <button onclick="setBloom('Aplicar')" id="bloom-Aplicar" class="bloom-btn">Aplicar</button>
                        <button onclick="setBloom('Entender')" id="bloom-Entender" class="bloom-btn">Entender</button>
                        <button onclick="setBloom('Lembrar')" id="bloom-Lembrar" class="bloom-btn active sky">Lembrar</button>
                    </div>
                    <div id="bloom-info-box" class="mt-6 p-6 rounded-[1.5rem] border transition-all duration-500 hidden">
                        <h4 id="bloom-info-title" class="font-black text-base mb-2 uppercase tracking-tight"></h4>
                        <p id="bloom-info-desc" class="text-xs italic mb-5 leading-relaxed"></p>
                        <div class="pt-4 border-t border-black/5">
                            <span class="text-[10px] font-black uppercase opacity-60 tracking-widest">Verbos Sugeridos</span>
                            <p id="bloom-info-verbs" class="text-xs font-bold mt-2 leading-relaxed"></p>
                        </div>
                    </div>
                </div>

                <div id="types-container" class="space-y-4"></div>

                <div class="bg-white p-7 rounded-[2.5rem] border border-slate-200 shadow-sm flex items-center justify-between">
                    <span class="text-xs font-black uppercase text-slate-500">Quantidade</span>
                    <div class="flex items-center gap-5 bg-slate-50 p-2 rounded-2xl">
                        <button onclick="updateQty(-1)" class="w-12 h-12 border-2 rounded-xl bg-white shadow-sm flex items-center justify-center font-bold">-</button>
                        <span id="qty-val" class="font-black text-slate-900 text-2xl">1</span>
                        <button onclick="updateQty(1)" class="w-12 h-12 border-2 rounded-xl bg-white shadow-sm flex items-center justify-center font-bold">+</button>
                    </div>
                </div>

                <button onclick="gerar()" id="btn-main" class="w-full bg-inep-600 text-white font-black py-6 rounded-[2rem] shadow-2xl active:scale-95 transition-all text-xl uppercase">Gerar Avaliação Profissional</button>
            </div>

            <div id="panel-auditor" class="hidden bg-white p-10 rounded-[3rem] border border-slate-200 shadow-sm text-center">
                <i data-lucide="microscope" class="w-12 h-12 text-emerald-600 mx-auto mb-6"></i>
                <h3 class="font-black text-emerald-800 text-xl uppercase">Auditoria Técnica</h3>
                <textarea id="audit-input" class="w-full p-6 bg-slate-50 border border-slate-200 rounded-[2rem] mt-8 mb-8 text-sm font-mono h-80 outline-none focus:bg-white transition-all" placeholder="Cole a questão..."></textarea>
                <button onclick="auditar()" id="btn-aud" class="w-full bg-emerald-600 text-white font-black py-5 rounded-2xl shadow-xl uppercase">Executar Laudo Técnico</button>
            </div>
        </aside>

        <div id="result-anchor" class="lg:col-span-7">
            <div class="bg-white min-h-[900px] border border-slate-200 rounded-[3.5rem] shadow-2xl p-8 lg:p-16 relative flex flex-col">
                <div id="tools" class="flex justify-end gap-4 mb-12 opacity-0 transition-all duration-1000">
                    <button onclick="exportWord()" class="px-6 py-3 border-2 border-blue-100 rounded-2xl text-xs font-black text-blue-700 bg-blue-50">Word</button>
                    <button onclick="exportPdf()" class="px-6 py-3 border-2 border-red-100 rounded-2xl text-xs font-black text-red-700 bg-red-50">PDF</button>
                </div>
                <div id="placeholder" class="flex-1 flex flex-col items-center justify-center text-center p-12 opacity-20">
                    <i data-lucide="sparkles" class="w-24 h-24 text-slate-300 mb-8"></i>
                    <h3 class="text-3xl font-black text-slate-400 uppercase tracking-[0.3em]">Studio</h3>
                </div>
                <div id="output" class="hidden prose prose-slate max-w-none text-base leading-relaxed animate-fade-in font-medium"></div>
            </div>
        </div>
    </main>

    <script>
        const BLOOM_INFO = {
            "Criar": { color: "indigo", desc: "Produzir um novo ponto de vista ou produto. Juntar partes para formar um todo coerente.", verbs: "GERAR, PLANEJAR, DESENVOLVER, CONSTRUIR, PROJETAR, PROPOR." },
            "Avaliar": { color: "indigo", desc: "Fazer julgamentos baseados em critérios. Emitir conclusões fundamentadas.", verbs: "JULGAR, CRITICAR, SELECIONAR, VALIDAR, REVISAR, CONCLUIR." },
            "Analisar": { color: "blue", desc: "Separar material em partes constituintes e determinar relações estruturais.", verbs: "DIFERENCIAR, ORGANIZAR, ATRIBUIR, DECOMPOR, INVESTIGAR." },
            "Aplicar": { color: "blue", desc: "Executar ou usar um procedimento em uma situação específica ou novo contexto.", verbs: "EXECUTAR, IMPLEMENTAR, USAR, DEMONSTRAR, CALCULAR, RESOLVER." },
            "Entender": { color: "sky", desc: "Construir significado a partir de mensagens, interpretando e resumindo informações.", verbs: "EXPLICAR, RESUMIR, INFERIR, PARAFRASEAR, INTERPRETAR." },
            "Lembrar": { color: "sky", desc: "Recuperar conhecimento relevante da memória de longo prazo para recordar fatos.", verbs: "CITAR, DEFINIR, LISTAR, IDENTIFICAR, NOMEAR, RECORDAR." }
        };

        const TYPES = {
            "SINGLE": { label: "Resposta Única", icon: "check-circle", example: "As mitocôndrias são organelas fundamentais para a vida celular eucariótica. Elas desempenham funções vitais relacionadas ao metabolismo energético por meio da cadeia transportadora de elétrons e da produção de adenosina trifosfato.\n\nQual a principal função da mitocôndria na célula animal.\n\na) Realizar a fotossíntese para produção de glicose.\nb) Produzir ATP através do processo de respiração celular.\nc) Sintetizar proteínas específicas no citoplasma rugoso.\nd) Armazenar e replicar o material genético principal.\ne) Realizar a digestão intracelular de macromoléculas.\n\n**Fonte:** Junqueira, L. C.; Carneiro, J. Biologia Celular e Molecular. Guanabara Koogan, 2012." },
            "INCOMPLETE": { label: "Afirmação Incompleta", icon: "pen-tool", example: "A Primeira Lei de Newton descreve o comportamento de corpos em repouso ou em movimento retilíneo uniforme quando a resultante das forças externas é nula. Esse conceito é fundamental para entender a dinâmica dos sistemas físicos e a resistência à mudança de estado de movimento.\n\nA inércia é definida, no contexto da física clássica, como a tendência natural de um corpo em\n\na) aumentar sua velocidade constantemente.\nb) permanecer em seu estado de repouso ou movimento retilíneo uniforme.\nc) alterar sua massa independentemente da força aplicada.\nd) desacelerar na ausência de atrito externo.\ne) reagir instantaneamente a forças internas do sistema.\n\n**Fonte:** Halliday, D.; Resnick, R. Fundamentos de Física. LTC, 2014." },
            "MULTIPLE": { label: "Complementação Múltipla", icon: "layers" },
            "ASSERTION": { label: "Asserção e Razão", icon: "git-compare", example: "O Transtorno do Processamento Auditivo Central (TPAC) afeta a interpretação sonora, exigindo avaliações específicas que considerem as vias auditivas centrais e não apenas a acuidade periférica do indivíduo.\n\nAnalise as seguintes asserções e a relação proposta entre elas.\n\nI. O diagnóstico diferencial do TPAC em uma avaliação neuropsicopedagógica é essencial, pois seus sintomas podem mimetizar outras dificuldades de aprendizagem, como o TDAH.\n\n<div class=\"text-center font-bold py-3\">PORQUE</div>\n\nII. O TPAC envolve uma falha específica nas vias auditivas centrais, exigindo uma abordagem multidisciplinar para a diferenciação clínica correta.\n\nA respeito dessas asserções, assinale a opção correta.\n\na) As asserções I e II são proposições verdadeiras, e a II é uma justificativa correta da I.\nb) As asserções I e II são proposições verdadeiras, mas a II não é uma justificativa correta da I.\nc) A asserção I é uma proposição verdadeira, e a II é uma proposição falsa.\nd) A asserção I é uma proposição falsa, e a II é uma proposição verdadeira.\ne) As asserções I e II são proposições falsas.\n\n**Fonte:** Katz, J. Tratado de Audiologia Clínica. Manole, 1999." },
            "DISCURSIVE": { label: "Discursiva", icon: "file-text", example: "A Inteligência Artificial Generativa tem reconfigurado drasticamente o cenário do ensino superior e os processos tradicionais de avaliação da aprendizagem, exigindo novos papéis docentes e uma visão ética aprofundada sobre a autoria intelectual.\n\nCom base nesse contexto, redija um texto dissertativo analisando os seguintes aspectos.\n\na) O impacto da IA na personalização da aprendizagem.\nb) Os desafios éticos relacionados à autoria e ao plágio acadêmico.\nc) O novo papel do docente na mediação do uso dessas ferramentas.\n\n<div class=\"text-center font-bold mb-4 tracking-tight uppercase\">**Grade de correção**</div>\n\nClareza e Etapas do Protocolo - O protocolo apresenta uma sequência lógica e clara de etapas, desde a sensibilização inicial até o encaminhamento.\nAdequação dos Instrumentos/Observações - Os instrumentos e critérios de observação propostos são pertinentes à Neuropsicopedagogia e ao TPAC.\nCritérios de Referência e Encaminhamento - São definidos critérios claros para a identificação de alunos em risco e o fluxo de encaminhamento.\n\n**Fonte:** UNESCO. Inteligência artificial e educação. 2023." }
        };

        const ASSERTION_LOGIC = { 'A': 'As asserções I e II são proposições verdadeiras, e a II é uma justificativa correta da I.', 'B': 'As asserções I e II são proposições verdadeiras, mas a II não é uma justificativa correta da I.', 'C': 'A asserção I é uma proposição verdadeira, e a II é uma proposição falsa.', 'D': 'A asserção I é uma proposição falsa, e a II é uma proposição verdadeira.', 'E': 'As asserções I e II são proposições falsas.' };

        let STATE = { bloom: 'Lembrar', type: 'SINGLE', assertionKey: 'A', multiRange: 4, quantity: 1 };

        function init() { renderTypes(); lucide.createIcons(); setBloom('Lembrar'); }

        function renderTypes() {
            const container = document.getElementById('types-container');
            container.innerHTML = '';
            Object.entries(TYPES).forEach(([key, info]) => {
                const active = STATE.type === key;
                const div = document.createElement('div');
                div.className = `type-card ${active ? 'active' : ''}`;
                div.onclick = () => { STATE.type = key; renderTypes(); };
                
                let html = `<div class="flex items-center gap-4"><i data-lucide="${info.icon}" class="w-6 h-6"></i><div class="flex-1 font-bold text-sm text-slate-800">${info.label}</div><div class="radio-circle"></div></div>`;
                
                if (active) {
                    let exText = info.example || "";
                    if (key === 'MULTIPLE') {
                        let items = ["I. A água atua como um solvente universal.", "II. O calor específico da água é baixo.", "III. A molécula de água possui caráter apolar.", "IV. A tensão superficial permite a vida aquática.", "V. A água atua na regulação térmica."];
                        let alts = ""; let cmd = "";
                        if (STATE.multiRange === 3) {
                            cmd = "É correto o que se afirma em";
                            alts = "a) I, apenas.\nb) II, apenas.\nc) I e III, apenas.\nd) II e III, apenas.\ne) I, II e III.";
                        } else {
                            cmd = "É correto apenas o que se afirma em";
                            alts = STATE.multiRange === 4 ? "a) I e II.\nb) I e IV.\nc) II e III.\nd) I, III e IV.\ne) II, III e IV." : "a) I, II e III.\nb) I, IV e V.\nc) II, III e IV.\nd) I, III e V.\ne) II, IV e V.";
                        }
                        exText = `A água possui propriedades únicas que permitem o equilíbrio biológico nos ecossistemas.\n\nAvalie as afirmações a seguir.\n\n${items.slice(0, STATE.multiRange).join('\n')}\n\n${cmd}\n\n${alts}\n\n**Fonte:** Pesquisa Acadêmica Academix. 2024.`;
                    }
                    html += `<div class="example-box"><div class="example-header"><i data-lucide="sparkles" class="w-3 h-3 text-inep-400"></i> Exemplo Íntegro</div><div class="whitespace-pre-line">${exText}</div></div>`;
                    if (key === 'MULTIPLE') html += `<div class="mt-5 flex gap-2">${[3,4,5].map(n => `<button onclick="event.stopPropagation(); STATE.multiRange=${n}; renderTypes();" class="ctrl-btn ${STATE.multiRange===n?'active':''}">I a ${n===3?'III':n===4?'IV':'V'}</button>`).join('')}</div>`;
                    if (key === 'ASSERTION') html += `<div class="mt-5 flex gap-2">${['A','B','C','D','E'].map(l => `<button onclick="event.stopPropagation(); STATE.assertionKey='${l}'; renderTypes();" class="key-btn ${STATE.assertionKey===l?'active':''}" title="${l}">${l}</button>`).join('')}</div><div class="mt-4 p-4 bg-slate-50 rounded-2xl text-[10px] font-bold text-inep-700 italic border-l-4 border-inep-500 shadow-sm animate-fade-in">${ASSERTION_LOGIC[STATE.assertionKey]}</div>`;
                }
                div.innerHTML = html;
                container.appendChild(div);
            });
            lucide.createIcons();
        }

        function setBloom(val) {
            STATE.bloom = val;
            const info = BLOOM_INFO[val];
            document.querySelectorAll('.bloom-btn').forEach(b => {
                b.className = 'bloom-btn';
                if(b.id === `bloom-${val}`) b.classList.add('active', info.color === 'sky' ? 'sky' : info.color === 'blue' ? 'blue' : 'indigo');
            });
            const box = document.getElementById('bloom-info-box');
            box.classList.remove('hidden', 'bg-bloomSky-100', 'bg-bloomBlue-100', 'bg-bloomIndigo-100', 'border-bloomSky-border', 'border-bloomBlue-border', 'border-bloomIndigo-border');
            const colorClass = info.color === 'sky' ? 'Sky' : info.color === 'blue' ? 'Blue' : 'Indigo';
            box.classList.add(`bg-bloom${colorClass}-100`, `border-bloom${colorClass}-border`);
            document.getElementById('bloom-info-title').innerText = val;
            document.getElementById('bloom-info-title').className = `font-black text-sm mb-1 uppercase text-bloom${colorClass}-800`;
            document.getElementById('bloom-info-desc').innerText = info.desc;
            document.getElementById('bloom-info-verbs').innerText = info.verbs;
        }

        function updateQty(n) { STATE.quantity = Math.max(1, Math.min(10, STATE.quantity + n)); document.getElementById('qty-val').innerText = STATE.quantity; }

        function setMode(mode) {
            const isGen = mode === 'generator';
            document.getElementById('panel-generator').classList.toggle('hidden', !isGen);
            document.getElementById('panel-auditor').classList.toggle('hidden', isGen);
            document.getElementById('tab-gen').className = isGen ? "px-6 py-2.5 rounded-xl text-xs font-black bg-white shadow-lg text-inep-700 transition-all" : "px-6 py-2.5 rounded-xl text-xs font-black text-slate-500 hover:text-slate-800 transition-all";
            document.getElementById('tab-aud').className = !isGen ? "px-6 py-2.5 rounded-xl text-xs font-black bg-white shadow-lg text-inep-700 transition-all" : "px-6 py-2.5 rounded-xl text-xs font-black text-slate-500 hover:text-slate-800 transition-all";
        }

        async function gerar() {
            const btn = document.getElementById('btn-main'); const original = btn.innerHTML;
            const curso = document.getElementById('curso').value; const conteudo = document.getElementById('conteudo').value;
            if(!curso || !conteudo) return alert("Erro: Preencha Curso e Conteúdo.");
            btn.innerHTML = 'Pesquisando Base de Conhecimento...'; btn.disabled = true;

            let promptExtras = "";
            if (STATE.type === 'ASSERTION') promptExtras = `GABARITO: ${STATE.assertionKey}. REGRAS: Comandos encerram com PONTO FINAL (.). O PORQUE deve vir em negrito e centralizado: <div style="text-align:center; font-weight:bold; margin:15px 0;">PORQUE</div>.`;
            if (STATE.type === 'MULTIPLE') promptExtras = `COMANDO FINAL: "${STATE.multiRange === 3 ? 'É correto o que se afirma em' : 'É correto apenas o que se afirma em'}". Use o balanceamento de numerais.`;
            if (STATE.type === 'INCOMPLETE') promptExtras = `REGRA: Enunciado SEM pontuação final. Alternativas minúsculas.`;
            if (STATE.type === 'DISCURSIVE') promptExtras = `ESTRUTURA: Use itens a), b) e c). Comando encerra com PONTO FINAL (.). GRADE DE CORREÇÃO: Título centralizado e em negrito: <div style="text-align:center; font-weight:bold; margin-top:30px; text-transform:uppercase;">**Grade de correção**</div>. FORMATO DOS ITENS: "Critério - Descrição" (sem numeração de pontos).`;

            const prompt = `Atue como Especialista INEP. Vocativo: "Prezado docente,". Curso: ${curso}. Tema: ${conteudo}. Tipo: ${TYPES[STATE.type].label}. Bloom: ${STATE.bloom}. Qtd: ${STATE.quantity}. REGRAS: Texto de suporte com NO MÍNIMO 500 caracteres fundamentados. Referência real em "**Fonte:**". Termine comandos com ponto final. ${promptExtras}\nSAÍDA: (Vocativo). (Texto suporte). (Fonte). (Comando). (Alternativas/Itens). Separador "---".`;

            try {
                const res = await fetch('/api/gemini', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ prompt }) });
                const data = await res.json();
                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('output').classList.remove('hidden');
                document.getElementById('tools').classList.remove('opacity-0');
                document.getElementById('output').innerHTML = marked.parse(data.text);
                if (window.innerWidth < 1024) setTimeout(() => { document.getElementById('result-anchor').scrollIntoView({ behavior: 'smooth' }); }, 100);
            } catch(e) { alert("Erro de conexão."); } finally { btn.innerHTML = original; btn.disabled = false; }
        }

        async function auditar() {
            const txt = document.getElementById('audit-input').value; if(!txt) return alert("Cole uma questão.");
            const btn = document.getElementById('btn-aud'); btn.innerHTML = 'Analisando...'; btn.disabled = true;
            try {
                const res = await fetch('/api/gemini', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ prompt: `ATUE COMO AUDITOR INEP. Analise estrutura técnica e taxonomia: ${txt}` }) });
                const data = await res.json();
                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('output').classList.remove('hidden');
                document.getElementById('output').innerHTML = marked.parse(data.text);
            } catch(e) { alert("Erro na auditoria."); } finally { btn.innerHTML = 'Executar Laudo Técnico'; btn.disabled = false; }
        }

        function exportWord() { const text = document.getElementById('output').innerText; const doc = new docx.Document({ sections: [{ children: [new docx.Paragraph({ children: [new docx.TextRun(text)] })] }] }); docx.Packer.toBlob(doc).then(blob => saveAs(blob, "Questao_StudioPro.docx")); }
        function exportPdf() { const el = document.getElementById('output'); html2pdf().set({ margin: 15, filename: 'Academicus_Pro.pdf' }).from(el).save(); }

        init();
    </script>
</body>
</html>
